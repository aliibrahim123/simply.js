var N=Object.defineProperty;var a=(o,e)=>N(o,"name",{value:e,configurable:!0});var P=(o,e)=>{for(var t in e)N(o,t,{get:e[t],enumerable:!0})};var n=class extends Error{constructor(e="serve: empty"){var t=e.indexOf(":");super(e.slice(t+1).trim()),this.name=e.slice(0,t)}};a(n,"ServerError");var b=a((o,e)=>{if(!Array.isArray(o))throw new n(`serve: ${e} of type (${o?.constructor?.name}), expected (Array)`)},"checkarr"),v=a((o,e)=>{if(typeof o!="function")throw new n(`serve: ${e} of type (${o?.constructor?.name}), expected (Function)`)},"checkfn"),m=a((o,e="str")=>{if(typeof o!="string")throw new n(`serve: ${e} of type (${o?.constructor?.name}), expected (String)`)},"checkstr");var w=a((o,e,t,r,p,d)=>(m(o,"path"),o.split("/").reduce((i,s,f,y)=>{var h=f===y.length-1;if(s[0]==="["){if(i.routes["[PARAM]"]){let c=i.routes["[PARAM]"];if(c.name!==s.slice(1,-1))throw new n(`serve: accessing parametric route (${c.path}) with name (${s})`);return c}return i.routes["[PARAM]"]=new d(t,i,h&&r,s,p)}return i.routes[s]?i.routes[s]:i.routes[s]=new d(t,i,h&&r,s,p)},e)),"addRoute");var C=["connect","delete","get","head","options","patch","post","put","trace"],u=class{constructor(e,t,r,p="",d={}){if(m(p,"name"),this.name=p.startsWith("[")?p.slice(1,-1):p,this.path=t?t.path+"/"+p:"",this.router=e,this.parent=t,this.handler={},!r)this.handler=null;else if(typeof r=="function")this.handler=r;else if(typeof r=="object")for(let s in r)this.method(s,r[s]);else throw new n(`serve: handler at path (${this.path}) of type (${r?.constructor?.name}), expected (Function) or (Object)`);var{portal:i}={portal:!1,...d};this.portal=i,this.routes={}}method(e,t){if(m(e,"method"),v(t,"handler"),this.handler===null)this.handler={};else if(typeof this.handler=="function")throw new n(`serve: adding methed (${e}) for (${this.path}) in presence of (all) handler`);if(C.includes(e))this.handler[e]=t;else throw new n(`serve: unsupported http method (${e}) at path (${this.path})`);return this}route(e,t,r={}){return w(e,this,this.router,t,r,u)}all(e,t){if(typeof e=="function"){if(v(e,"handler"),this.handler)throw new n(`can not add handler in presence of other at path (${this.path})`);return this.handler=e,this}return this.route(e,t)}connect(e,t){return typeof e=="function"?this.method("connect",e):this.route(e).method("connect",t)}delete(e,t){return typeof e=="function"?this.method("delete",e):this.route(e).method("delete",t)}get(e,t){return typeof e=="function"?this.method("get",e):this.route(e).method("get",t)}head(e,t){return typeof e=="function"?this.method("head",e):this.route(e).method("head",t)}options(e,t){return typeof e=="function"?this.method("options",e):this.route(e).method("options",t)}patch(e,t){return typeof e=="function"?this.method("patch",e):this.route(e).method("patch",t)}post(e,t){return typeof e=="function"?this.method("post",e):this.route(e).method("post",t)}put(e,t){return typeof e=="function"?this.method("put",e):this.route(e).method("put",t)}trace(e,t){return typeof e=="function"?this.method("trace",e):this.route(e).method("trace",t)}};a(u,"Route");var x={};P(x,{no_handler:()=>g,undefined_method:()=>A,undefined_route:()=>$});var $=Symbol("undefined_route"),g=Symbol("no_handler"),A=Symbol("undefined_method");var _={};P(_,{Accepted:()=>q,Already_Reported:()=>D,Bad_Gateway:()=>Pe,Bad_Request:()=>Z,Conflict:()=>ae,Content_Too_Large:()=>he,Continue:()=>T,Created:()=>U,Early_Hints:()=>I,Expectation_Failed:()=>le,Failed_Dependency:()=>ye,Forbidden:()=>re,Found:()=>W,Gateway_Timeout:()=>ke,Gone:()=>se,HTTP_Version_Not_Supported:()=>Ce,IM_Used:()=>V,Im_a_teapot:()=>ve,Insufficient_Storage:()=>Ee,Internal_Server_Error:()=>Me,Length_Required:()=>pe,Locked:()=>_e,Loop_Detected:()=>Fe,Method_Not_Allowed:()=>S,Misdirected_Request:()=>me,Moved_Permanently:()=>K,Multi_Status:()=>B,Multiple_Choices:()=>z,Network_Authentication_Required:()=>Le,No_Content:()=>O,Non_Authoritative_Information:()=>H,Not_Acceptable:()=>oe,Not_Extended:()=>Ie,Not_Found:()=>R,Not_Implemented:()=>Ne,Not_Modified:()=>Q,OK:()=>L,Partial_Content:()=>G,Payment_Required:()=>te,Permanent_Redirect:()=>Y,Precondition_Failed:()=>ue,Precondition_Required:()=>$e,Processing:()=>F,Proxy_Authentication_Required:()=>ie,Range_Not_Satisfiable:()=>fe,Request_Header_Fields_Too_Large:()=>Ae,Request_Timeout:()=>ne,Reset_Content:()=>j,See_Other:()=>J,Service_Unavailable:()=>be,Switching_Protocols:()=>E,Temporary_Redirect:()=>X,Too_Early:()=>we,Too_Many_Requests:()=>ge,URI_Too_Long:()=>de,Unauthorized:()=>ee,Unavailable_For_Legal_Reasons:()=>Se,Unprocessable_Content:()=>xe,Unsupported_Media_Type:()=>ce,Upgrade_Required:()=>Re,Variant_Also_Negotiates:()=>Te});var T=100,E=101,F=102,I=103,L=200,U=201,q=202,H=203,O=204,j=205,G=206,B=207,D=208,V=226,z=300,K=301,W=302,J=303,Q=304,X=307,Y=308,Z=400,ee=401,te=402,re=403,R=404,S=405,oe=406,ie=407,ne=408,ae=409,se=410,pe=411,ue=412,he=413,de=414,ce=415,fe=416,le=417,ve=418,me=421,xe=422,_e=423,ye=424,we=425,Re=426,$e=428,ge=429,Ae=431,Se=451,Me=500,Ne=501,Pe=502,be=503,ke=504,Ce=505,Te=506,Ee=507,Fe=508,Ie=510,Le=511;var k=a(async(o,e,t,r)=>{var p=r.params={},d=e.url.split("/"),i=o.root;for(let h=1;h<d.length;h++){let c=d[h];if(i.routes[c])i=i.routes[c];else if(i.routes["[PARAM]"])i=i.routes["[PARAM]"],p[i.name]=c;else if(i.portal){r.path=d.slice(h);break}else return o.error($,R,e,t)}i.portal&&!r.path&&(r.path=[]);var s=e.method.toLowerCase(),f=i.handler;if(!f)return o.error(g,R,e,t,i);if(typeof f=="object")if(f[s])f=f[s];else return o.error(A,S,e,t,s);var y=o.middlewares;for(let h=0;h<y.length;h++)await new Promise(c=>y[h](e,t,r,c));f(e,t,r)},"handleRoute");var l=class{constructor(e=[]){b(e,"middlewares"),e.forEach((t,r)=>v(t,`middleware at index (${r})`)),this.middlewares=e,this.root=new u,this.listener=this.handle.bind(this)}handle(e,t,r={}){k(this,e,t,r)}use(...e){e.forEach((t,r)=>v(t,`middleware at index (${r})`)),this.middlewares.push(...e)}error(e,t,r,p,...d){p.writeHead(t),p.end()}route(e,t,r={}){return w(e,this.root,this,t,r,u)}all(e,t){return this.route(e,t)}connect(e,t){return this.route(e).method("connect",t)}delete(e,t){return this.route(e).method("delete",t)}get(e,t){return this.route(e).method("get",t)}head(e,t){return this.route(e).method("head",t)}options(e,t){return this.route(e).method("options",t)}patch(e,t){return this.route(e).method("patch",t)}post(e,t){return this.route(e).method("post",t)}put(e,t){return this.route(e).method("put",t)}trace(e,t){return this.route(e).method("trace",t)}};a(l,"Router");var M=a(o=>new l(o),"make");globalThis.$serve?($serve.make=M,$serve.Router=l,$serve.Route=u,$serve.ServerError=n,$serve.httpStatus=_,$serve.errorCodes=x):globalThis.$serve={make:M,Router:l,Route:u,ServerError:n,httpStatus:_,errorCodes:x};var mt=$serve;export{q as Accepted,D as Already_Reported,Pe as Bad_Gateway,Z as Bad_Request,ae as Conflict,he as Content_Too_Large,T as Continue,U as Created,I as Early_Hints,le as Expectation_Failed,ye as Failed_Dependency,re as Forbidden,W as Found,ke as Gateway_Timeout,se as Gone,Ce as HTTP_Version_Not_Supported,V as IM_Used,ve as Im_a_teapot,Ee as Insufficient_Storage,Me as Internal_Server_Error,pe as Length_Required,_e as Locked,Fe as Loop_Detected,S as Method_Not_Allowed,me as Misdirected_Request,K as Moved_Permanently,B as Multi_Status,z as Multiple_Choices,Le as Network_Authentication_Required,O as No_Content,H as Non_Authoritative_Information,oe as Not_Acceptable,Ie as Not_Extended,R as Not_Found,Ne as Not_Implemented,Q as Not_Modified,L as OK,G as Partial_Content,te as Payment_Required,Y as Permanent_Redirect,ue as Precondition_Failed,$e as Precondition_Required,F as Processing,ie as Proxy_Authentication_Required,fe as Range_Not_Satisfiable,Ae as Request_Header_Fields_Too_Large,ne as Request_Timeout,j as Reset_Content,u as Route,l as Router,J as See_Other,n as ServerError,be as Service_Unavailable,E as Switching_Protocols,X as Temporary_Redirect,we as Too_Early,ge as Too_Many_Requests,de as URI_Too_Long,ee as Unauthorized,Se as Unavailable_For_Legal_Reasons,xe as Unprocessable_Content,ce as Unsupported_Media_Type,Re as Upgrade_Required,Te as Variant_Also_Negotiates,mt as default,x as errorCodes,_ as httpStatus,M as make,g as no_handler,A as undefined_method,$ as undefined_route};
