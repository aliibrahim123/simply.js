var W=Object.defineProperty;var a=(e,t)=>W(e,"name",{value:t,configurable:!0});var d=a((e,t)=>{if(!(e instanceof Element))throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Element)`)},"checkel"),v=a((e,t)=>{if(!(e instanceof Node))throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Node)`)},"checknode"),l=a((e,t)=>{if(typeof e!="string")throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (String)`)},"checkstr"),E=a((e,t)=>{if(typeof e!="function")throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Function)`)},"checkfn"),C=a((e,t)=>{if(!Array.isArray(e))throw new TypeError(`edit: ${t} of type (${e?.constructor?.name}), expected (Array)`)},"checkarr");var p=a(e=>{d(e,"element"),e.after(...e.childNodes),e.remove()},"unwrap"),S=a(()=>{var e=getSelection();if(e.rangeCount){var t=e.getRangeAt(0),r=t.startContainer;for(r.nodeType!==r.ELEMENT_NODE&&(r=r.parentElement);!r.hasAttribute("contenteditable");){if(r===document.body)return;r=r.parentElement}return r}},"getContainer"),k=a((e,t,r)=>{d(e,"element"),t&&v(t,"offset element"),r&&d(r,"offset parent");var i=e.cloneNode(!1),s=Array.from(e.childNodes),n=!1;for(let o=0;o<s.length;o++){let c=s[o];(n||c===t)&&(n=!0,i.append(c))}return r?r.prepend(i):e.after(i),i},"splitEl"),f=a((e,t)=>{l(e,"tag"),t&&E(t,"function");var r=getSelection();if(r.rangeCount){var i=r.getRangeAt(0),s=S();if(s)for(var n=i.commonAncestorContainer;n!==s;){if(n.tagName===e.toUpperCase()&&(!t||t(n)))return n;n=n.parentElement}}},"getWrapped");var y=a((e,t,r=!0,i,s={})=>{d(e,"element"),l(t,"tag"),i&&E(i,"cleaner"),t=t.toLowerCase();var n=[...e.getElementsByTagName(t)];r&&e.tagName===t.toUpperCase()&&n.push(e),n=n.filter(o=>Array.from(o.classList).every(c=>c in h?h[c](o,s[c]):!0)),i&&(n=n.filter(i)),n.forEach(o=>p(o))},"clean"),T=a((e,t=[],r=[],i=new Set)=>{if(v(e,"node"),C(t,"doNotCleanTags"),e.nodeType===e.ELEMENT_NODE){var s=Array.from(e.childNodes),n=e.tagName.toLowerCase();t.includes(n)||(e.childNodes.length===0?e.remove():r.includes(n)||(e.tagName===e.previousSibling?.tagName?(e.previousSibling.append(...s),e.remove()):i.has(n)&&!Array.from(e.classList).some(o=>o in h)&&(e.after(...s),e.remove()))),s.forEach(o=>T(o,t,r,new Set([...i,n])))}else e.textContent===""?e.remove():e.previousSibling?.nodeType===e.TEXT_NODE&&(e.previousSibling.textContent+=e.textContent,e.remove())},"cleanDom"),h={styled(e,t){if(!t)return!1;var[r,i]=t;return e.classList.contains(i+"-"+r)&&(e.classList.remove(i+"-"+r),e.style[r]=""),[...e.classList].reduce((s,n)=>n.startsWith(i)?s+1:s,0)===1}};var R={unwrap:p,getContainer:S,splitEl:k,getWrapped:f,clean:y,cleanDom:T,cleanMap:h,isWrappedWith(e,t){return!!f(e,t)},surround(e,t=!0,r,i){d(e,"wrapper");var s=getSelection();if(!s.rangeCount)return{success:!1};var n=s.getRangeAt(0);return e.append(...n.cloneContents().childNodes),n.deleteContents(),t&&y(e,e.tagName,!1,r,i),n.insertNode(e),{success:!0,type:"surround",node:e}},undo(e,t,r){var i=getSelection();if(!i.rangeCount)return{success:!1};var s=i.getRangeAt(0),n=s.cloneContents();s.deleteContents();var o=document.createElement("span");o.append(n),y(o,e,!1,t,r),s.insertNode(o);var c=f(e,t);if(!c){var N=o.childNodes[0],x=o.childNodes[o.childNodes.length-1];return p(o),s.setStartBefore(N),s.setEndAfter(x),{success:!0,type:"undo"}}for(var g=o,m=[g];g!==c;)g=g.parentElement,m.unshift(g);var w;m.forEach((u,L)=>{u!==c&&(w=k(u.parentElement,u.nextSibling,w))});var b=m.reduce((u,L,$)=>{if($===m.length-1)return u;var A=L.cloneNode(!1);return u===c?u.after(A):u.append(A),A});b===c?c.after(o):b.append(o);var N=o.childNodes[0],x=o.childNodes[o.childNodes.length-1];return p(o),s.setStartBefore(N),s.setEndAfter(x),{success:!0,type:"undo"}},replace(e="",t="text",r=!1){l(t,"replace type");var i=getSelection();if(!i.rangeCount)return{success:!1};var s=i.getRangeAt(0);if(s.deleteContents(),t==="node")s.insertNode(e);else{l(e,"topaste");let n=document.createElement("span");if(t==="text")n.innerText=e;else if(t==="html")n.innerHTML=e;else throw new TypeError("edit: undefined replace type ("+t+")");s.insertNode(n),r&&r(n)}return{success:!0,type:"replace"}},applyCss(e,t,r="span",i="styled",s=!0,n){l(e,"property"),l(t,"value");var o=document.createElement(r);return o.classList.add(i),o.classList.add(i+"-"+e),o.style[e]=t,this.surround(o,s,n,{styled:[e,i]})},copy(){var e=getSelection();if(!e.rangeCount)return"";var t=e.getRangeAt(0),r=document.createElement("div");return r.append(t.cloneContents()),r.innerHTML},cut(){var e=getSelection();if(!e.rangeCount)return"";var t=e.getRangeAt(0),r=document.createElement("div");return r.append(t.extractContents()),r.innerHTML},delete(){var e=getSelection();if(!e.rangeCount)return{success:!1};var t=e.getRangeAt(0);return t.deleteContents(),{success:!0,type:"delete"}},insert(e,t="text",r=!1){l(t,"insert type");var i=getSelection();if(!i.rangeCount)return{success:!1};var s=i.getRangeAt(0);if(t==="node")s.insertNode(e);else{l(e,"toinsert");var n=document.createElement("span");if(t==="text")n.innerText=e;else if(t==="html")n.innerHTML=e;else throw new Error("edit: undefined insert type ("+t+")");s.insertNode(n),r&&r(n)}return{success:!0,type:"insert"}},toggle(e,t=0,r,i,s){var n;if(e?.nodeType?(n=e,e=e.tagName.toLowerCase()):n=document.createElement(e),t===0)return this.isWrappedWith(e)?this.undo(e,i,s):this.surround(n,r,i,s);if(t===1)return this.surround(n,r,i,s);if(t===2)return this.undo(e,i,s);throw new Error("edit: toggle type is ("+t+"), expected 0, 1, or 2")},removeFormat(e=["b","i","u","s","sup","sub","span","div"]){C(e,"tagNames");var t=getSelection();if(!t.rangeCount)return{success:!1};var r=t.getRangeAt(0),i=t.toString();return r.deleteContents(),r.insertNode(new Text(i)),e.forEach(s=>this.undo(s)),{success:!0,type:"remove-format"}},getSelectedElement(){var e=getSelection();if(e.rangeCount){var t=e.getRangeAt(0).commonAncestorContainer;return t.nodeType===3?t.parentNode:t}},selectParagraph(){var e=getSelection();if(!e.rangeCount)return{success:!1};var t=e.getRangeAt(0),r=f("p");return r?(t.selectNode(r),{success:!0,type:"select"}):this.selectAll()},selectAll(){var e=getSelection();if(!e.rangeCount)return{success:!1};var t=e.getRangeAt(0),r=this.getContainer();return t.setStartBefore(r.firstChild),t.setEndAfter(r.lastChild),{success:!0,type:"select"}},bold(e){return this.toggle("b",e)},underline(e){return this.toggle("u",e)},italic(e){return this.toggle("i",e)},strikeThrough(e){return this.toggle("s",e)},subscript(e){return this.toggle("sub",e)},superscript(e){return this.toggle("sup",e)},backColor(e){return this.applyCss("background-color",e||"")},fontColor(e){return this.applyCss("color",e||"")},fontName(e){return this.applyCss("font-family",e||"")},fontSize(e){return this.applyCss("font-size",e||"")},link(e,t=!1){l(e,"url");var r=document.createElement("a");return r.href=e,t&&this.isWrappedWith("a")?this.undo("a"):this.surround(r)},img(e){l(e,"url");var t=document.createElement("img");return t.src=e,this.insert(t,"node")},heading(e=1,t){return this.toggle("h"+e,t)},orderedList(){var e=this.surround(document.createElement("li")),t=document.createElement("ol");return e.node.before(t),t.append(e.node),e},unorderedList(){var e=this.surround(document.createElement("li")),t=document.createElement("ul");return e.node.before(t),t.append(e.node),e},block(e){return this.toggle("div",e)},inline(e){return this.toggle("span",e)},paragraph(){var e=f("p");return e?(p(e),{success:!0,type:"undo"}):this.surround(document.createElement("p"))},quote(e){return this.toggle("q",e)},indent(e){return this.selectParagraph(),this.applyCss("text-indent",e||"","div")},align(e){return this.selectParagraph(),this.applyCss("text-align",e||"","div")},direction(e){return this.applyCss("direction",e||"","div")},hr(){return this.insert(document.createElement("hr"),"node")}};globalThis.$edit=R;var J=R;export{J as default};
