(()=>{var F=Object.defineProperty;var ee=(r,e,t)=>e in r?F(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e)=>F(r,"name",{value:e,configurable:!0});var l=(r,e,t)=>(ee(r,typeof e!="symbol"?e+"":e,t),t);var m=class extends Error{constructor(e="comp: empty"){var t=e.indexOf(":");super(e.slice(t+1)),this.name=e.slice(0,t)}};d(m,"CompError");var w=class{constructor(e={},t=!0,s="warn"){this.events=e,this.warn=s,this.addUndef=t}add(e){return e in this.events&&this.warn&&console[this.warn]("event: adding defined event ("+e+")"),this.events[e]=[],this}has(e){return e in this.events}on(e,t){if(typeof e=="object"){for(let s in e)this.on(s,e[s]);return this}return typeof t!="function"?(this.warn&&console[this.warn]("event: value of type ("+(t?.constructor?.name||t)+"), expected (Function)"),this):(e in this.events?this.events[e].push(t):this.addUndef?this.events[e]=[t]:this.warn&&console[this.warn]("event: udefined event ("+e+")"),this)}off(e,t){return e in this.events||this.warn&&console[this.warn]("event: udefined event ("+e+")"),t?this.events[e].splice(this.events[e].indexOf(t),1):this.events[e]=[],this}once(e,t){if(e in this.events){var s=d((...i)=>{t(...i),this.off(e,s)},"onceFn");this.on(e,s)}else this.addUndef?this.events[e]=[t]:this.warn&&console[this.warn]("event: udefined event ("+e+")");return this}trigger(e,...t){return e in this.events?this.events[e].forEach(s=>s(...t)):this.warn&&console[this.warn]("event: udefined event ("+e+")"),this}};d(w,"EventEmmiter");var M={toStr(r,e){return String(e)},toJSON(r,e){return JSON.stringify(e)},toBase64(r,e){return btoa(e)},toNb(r,e){return Number(e)},toggle(r,e,t){if(Array.isArray(t)){t.length===0&&r.comp.warn("model fn (toggle): checklist is empty");var s=t.indexOf(e)+1;return t[s>t.length-1?0:s]}else return r.comp.warn("model fn (toggle): checklist of type ("+t?.constructor?.name+"), expected (Array)"),e},toggleBl(r,e){return!e},inc(r,e,t=1){var s=Number(e);return isNaN(s)?0:s+(t-0)},incMinMax(r,e,t=0,s=60,i=1){var n=Number(e);return isNaN(n)?t:Math.max(Math.min(n+i,s),t)},incCircular(r,e,t=0,s=60,i=1){var n=Number(e);if(isNaN(n))return t;var o=n+i,a=s-t;return(o-t)%a+(o<t?t+a:t)},random(r,e,t=0,s=100,i=!0){var n=Math.random()*(s-t)+t;return i?Math.round(n):n},min(r,e,t=0){var s=Number(e);return isNaN(s)?t:Math.min(s,t)},max(r,e,t=100){var s=Number(e);return isNaN(s)?t:Math.max(s,t)},minMax(r,e,t=0,s=100){var i=Number(e);return isNaN(i)?t:Math.max(t,Math.min(i,s))},circular(r,e,t=0,s=60){var i=Number(e);if(isNaN(i))return t;var n=s-t;return(i-t)%n+(i<t?t+n:t)},round(r,e){return Math.round(Number(e))},split(r,e,t){return e?.split?e.split(t):(r.comp.warn("model fn (split): value does not has (split)"),e)},replace(r,e,t,s){return e?.replaceAll?e.replaceAll(t,s):(r.comp.warn("model fn (replace): value does not has (replaceAll)"),e)},join(r,e,t){return e?.join?e.join(t):(r.comp.warn("model fn (join): value does not has (join)"),e)},push(r,e,t){return e?.push?(e.push(t),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:e.length-1,values:[t]}}):(r.comp.warn("model fn (push): value does not has (push)"),e)},pop(r,e){return e?.pop?e.length===0?e:(e.pop(),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:e.length}}):(r.comp.warn("model fn (pop): value does not has (pop)"),e)},unshift(r,e,t){return e?.unshift?(e.unshift(t),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:0,values:[t]}}):(r.comp.warn("model fn (unshift): value does not has (unshift)"),e)},shift(r,e){return e?.shift?e.length===0?e:(e.shift(),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:0}}):(r.comp.warn("model fn (shift): value does not has (shift)"),e)},arrSet(r,e,t,s=0){return Array.isArray(e)?(e.length<=s&&r.comp.warn("model fn (arrSet): index ( "+s+" ) greater than length ( "+e.length+" )"),e[s]=t,{$hasMeta:!0,value:e,meta:{"arr:op":"change",force:!0,ind:s,values:[t]}}):(r.comp.warn("model fn (arrSet): property of type ("+e?.constructor?.name+"), expected (Array)"),e)},arrIns(r,e,t,s=0){return Array.isArray(e)?(e.length<s&&r.comp.warn("model fn (arrSet): index ( "+s+" ) greater than length ( "+e.length+" )"),e.splice(s,0,t),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:s,values:[t]}}):(r.comp.warn("model fn (arrSet): property of type ("+e?.constructor?.name+"), expected (Array)"),e)},arrDel(r,e,t=0){return Array.isArray(e)?(e.length<=t&&r.comp.warn("model fn (arrDel): index ( "+t+" ) greater than length ( "+e.length+" )"),e.splice(t,1),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:t}}):(r.comp.warn("model fn (arrDel): property of type ("+e?.constructor?.name+"), expected (Array)"),e)}};var te={set(r,e,t){r.set(e,t)},get(r,e){return r.get(e)},has(r,e){return r.has(e)},deleteProperty(r,e){return r.delete(e)},ownKeys(r){return r.getAllKeys()}},T=d(r=>new Proxy(r,te),"createProxy");var g=class{class=this.constructor;constructor(e,t={},s={}){if(!e?.isComp)throw new CompError("model: component of type ("+e?.constructor?.name+"), expected (@componnt)");this.comp=e,this.funs=this.class.funs,this.opts={...this.class.defaults,...t},this.data={};for(let i in s)this.addLow(i,s[i]);this.deps={},this.init(),this.comp.trigger("init:model",this)}init(){}addLow(e,t){if(t?.$hasMeta)var s={...this.opts.propObj,...t,name:e};else var s={...this.opts.propObj,value:t,name:e};if(s.meta={...s.meta},this.data[e])if(this.comp.warn("model: adding defined property ("+e+")"),this.opts.addDef)this.data[e]=s;else return;else this.data[e]=s;return s.init&&s.init(this.comp,this),this.comp.trigger("model:add",this,e,s),s}add(e,t,s=!1){var i=this.addLow(e,t);return i&&i.isReactive&&this.opts.propagate&&this.propagate(e,i),s?i:i?i.value:this}propagate(e,t=this.data[e],s,i=t.value,n={}){t?(n.force===!0||this.opts.doPropagate(s,i))&&(this.comp.trigger("model:propag",this,e,t,s,i,n),n.propagDeps!==!1&&this.deps[e]&&this.deps[e].forEach(o=>this.propagate(o,void 0,void 0,void 0,{propagDeps:!1,force:!0})),this.opts.propagParent&&i!==t.value&&this.propagate(t.name,t,void 0,void 0,{force:!0,sinceChild:!0})):this.comp.warn("model: propagating undefined property ("+e+")")}getLow(e,t=!1){var s=String(e).split(".");if(s.length===0)return[];var i=this.data[s[0]];if(!i&&t===!1)return this.comp.warn("model: stoped at path ("+s[0]+")"),[void 0,void 0,void 0,s,n];var n=!1;!i&&t&&(i=this.addLow(s[0],{}))&&(n=!0);var o=i.value,a;if(s.length===1)return[o,i,o,s,n];if(o==null)return this.comp.warn("model: stoped at path ("+s.join(".")+")"),[void 0,i,void 0,s,n];for(let p=0;p<s.length;p++)if(p!==0&&p!==s.length-1)if(a=s[p],o[a]!==void 0&&o[a]!==null)o=o[a];else if(t)o[a]={},o=o[a];else return this.comp.warn("model: stoped at path ("+s.slice(0,p+1).join(".")+")"),[void 0,i,void 0,s,n];return[o[s[s.length-1]],i,o,s,n]}setLow(e,t){var[s,i,n,o,a]=this.getLow(e,!0);return i.setter?i.setter(t,o,comp):o.length===1?i.value=t:n[o[o.length-1]]=t,[i,a?void 0:s,t]}set(e,t,s=!1,i={}){if(typeof e=="object"){for(let p in e)this.set(p,e[p]);return this}var[n,o,a]=this.setLow(e,t);return n.isReactive&&this.opts.propagate&&this.propagate(e,n,o,a,i),s?n:this}get(e,t=!1){var[s,i,n,o]=this.getLow(e,!1);if(i)return t?i:i.getter?i.getter(o):s}getFn(e,t,...s){var i=this.get(e),n=typeof t=="function"?t:this.funs[t];if(!n)throw new CompError("model: undefined function ("+t+")");var o=n(this,i,...s);return o?.$hasMeta?o.value:o}setFn(e,t,s=!0,...i){var n=this.get(e),o=typeof t=="function"?t:this.funs[t];if(!o)throw new CompError("model: undefined function ("+t+")");var a=s?o(this,n,...i):o(this,...i),p=a?.$hasMeta?a.value:a;return this.set(e,p,!1,a?.meta),this}has(e){return!!this.data[e]}delete(e){return this.data[e]===void 0?!1:(this.data[e]=void 0,this.comp.trigger("model:delete",this,e),!0)}getAllKeys(){return Object.keys(this.data).filter(e=>this.data[e]!==void 0)}addDep(e,t){return Array.isArray(e)?e.forEach(s=>this.deps[s]?this.deps[s].push(...t):this.deps[s]=[...t]):this.deps[e]?this.deps[e].push(...t):this.deps[e]=[...t],this}toProxy(){return T(this)}toObj(){var e={};for(let t in this.data)e[t]=this.get(t);return e}toJSON(){return JSON.stringify(this.toObj())}};d(g,"Model"),l(g,"defaults",{addDef:!1,propObj:{$hasMeta:!0,meta:{},isReactive:!0,name:""},propagate:!0,doPropagate:(e,t)=>e!==t,propagParent:!1,propagDeps:!0}),l(g,"funs",M);var k={$subInd(r){for(var e=r.$subEl?r.$subEl:r;!e.$comp&&!e.$isSub;)e=e.parentElement;return e.$comp?null:(r.$subEl=e,[...e.parentElement.children].indexOf(e))}};var P={show(r,e){r.forEach(t=>t.style.display=e?"":"none")}};var v=class{class=this.constructor;constructor(e,t={},s){if(!e?.isComp)throw new CompError("view: component of type ("+e?.constructor?.name+"), expected (@componnt)");this.comp=e,this.opts={...this.class.defaults,...t},s=s?.nodeType===1?s:this.$(this.opts.el)[0],s.$comp=e,this.el=s,this.comp.el=s,this.attrs=this.class.attrs,this.funs=this.class.funs,this.subs=this.opts.subs,this.subs={};for(let n in this.opts.subs){let o=this.opts.subs[n];this.subs[n]=o.$isSub?o:this.$(o)[0]}this.refs={};var i=this.opts.refs;for(let n in i)this.refs[n]=this.$(i[n]);this.comp.refs=this.refs,this.opts.lazyTemp?(this.comp.waitingNb++,$comp.temps.getLazy(this,this.opts.temp)):this.render(),e.trigger("init:view",this)}$(e,t=this.el){return $el(e,t)}render(){var e=this.opts.temp,t=this.el,s,i=[],n=this.opts.tempAppendMode;if(typeof e=="string"?e[0]==="<"?s=this.$(e):{els:s,acts:i=[]}=$comp.temps.get(e)(this):e.nodeType===1?s=e.cloneNode(!0).childNodes:{els:s="",acts:i=[]}=e(this),n==="replace")t.replaceChildren(...s);else if(n==="append")t.append(...s);else if(n==="prepend")t.prepend(...s);else throw new CompError("view: undefined append mode ("+n+")");return i.forEach(o=>this.comp.doAct(o)),this.comp.trigger("render",this),this}walk(e,t=[]){return e.forEach(s=>$comp.attrs.walk(this.comp,s,t)),this}addRef(e,t){var s=this.$(t);return s.length===0?this.comp.warn("view: no element with specific selector ("+t+")"):this.refs[e]?this.refs[e].push(...s):this.refs[e]=s,this}attr(e,t,s){var i=this.$(e);if(s===void 0)return t in this.attrs?this.attrs[t](i[0]):t in i[0]?i[0][t]:i[0].getAttribute(t);i.forEach(n=>{t in this.attrs?this.attrs[t](n,s):t in n?n[t]=s:n.setAttribute(t,s)})}call(e,t,...s){if(t in this.funs)return this.funs[t](this.$(e),...s);this.comp.warn("view: undefined function ("+t+")")}appendSub(e,t,s=-1,...i){var n=this.subs[t],o,a=[];if(!n)throw new CompError("view: undefined sub ("+t+")");return this.$(e).forEach(p=>{n.$isSub?{el:o,acts:a}=n.fn(p,this,!0,...i):o=n[0].cloneNode(!0),o.$isSub=!0,s===-1||s===p.children.length?p.append(o):s===0?p.prepend(o):p.children[s].before(o),(!("dowalk"in n)||n.dowalk)&&this.walk([o]),a?.forEach?.(c=>this.comp.doAct(c))}),this}setSub(e,t,s="append",...i){var n=this.subs[t],o,a=[];if(!n)throw new CompError("view: undefined sub ("+t+")");return this.$(e).forEach(p=>{if(n.$isSub?{el:o,acts:a}=n.fn(p,this,!1,...i):o=n.cloneNode(!0),s==="append")p.append(...o);else if(s==="prepend")p.prepend(...o);else if(s==="replace")p.replaceChildren(...o);else throw new CompError("view: undefined append mode ("+s+")");(!("dowalk"in n)||n.dowalk)&&this.walk([...p.children]),a?.forEach?.(c=>this.comp.doAct(c))}),this}};d(v,"View"),l(v,"defaults",{tempAppendMode:"append",temp:"<span></span>",lazyTemp:!1,el:"<div></div>",subs:{},refs:{}}),l(v,"attrs",k),l(v,"funs",P);var A=class{constructor(e,t){if(!e?.isComp)throw new CompError("effect: component of type ("+e?.constructor?.name+"), expected (@componnt)");this.comp=e,this.effects={...t},e.on("model:propag",this.patch.bind(this))}patch(e,t,s,i,n,o,a){this.effects[s]&&this.effects[s].forEach(p=>typeof p=="string"?e.call(p,o,n,i,s,a):p(e,o,n,i,s,a))}add(e,t){return typeof t!="function"&&typeof t!="string"?(this.comp.warn("effect: effect of type ("+t?.constructor?.name+"), expected (Function)"),this):(Array.isArray(e)?e.forEach(s=>this.add(s,t)):e in this.effects?this.effects[e].push(t):this.effects[e]=[t],this)}remove(e,t){return t?this.effects[e]?this.effects[e]=this.effects[e].filter(s=>s!==t):this.comp.warn("effect: undefined property ("+e+")"):this.effects[e]?this.effects[e]=void 0:this.comp.warn("effect: undefined property ("+e+")"),this}};d(A,"EffectEmmiter");var y=class{constructor(e,t,s){if(!e?.isComp)throw new CompError("signal: component of type ("+e?.constructor?.name+"), expected (@componnt)");this.comp=e,this.channels={},this.opts={...this.constructor.defaults,...t},this.add(s),e.on("model:propag",this.patch.bind(this))}patch(e,t,s,i,n,o,a){this.channels[s]&&this.channels[s].forEach(p=>p[0].set(p[1],o))}add(e,t){if(Array.isArray(e))e.forEach(s=>this.add(s[0],s[1]));else{if(!e?.isComp){this.comp.warn("signal: component of type ("+e?.constructor?.name+"), expected (@component)");return}for(let s in t)this.channels[s]?this.channels[s].push([e,t[s]]):this.channels[s]=[[e,t[s]]],this.opts.fireOnAdd&&e.set(t[s],this.comp.get(s))}}remove(e,t){if(e?.isComp)if(t)this.channels[t]?this.channels[t]=this.channels[t].filter(s=>s[0]!==e):this.comp.warn("signal: undefined property ("+t+")");else for(let s in this.channels)this.channels[s]&&(this.channels[s]=this.channels[s].filter(i=>i[0]!==e));else this.channels[e]||this.comp.warn("signal: undefined property ("+e+")"),this.channels[e]=void 0}};d(y,"Signal"),l(y,"defaults",{fireOnAdd:!0});var O=d((r,e,t,s,i)=>{if(e.mtype==="sub")r.view.appendSub(e.el,e.stype,s,t,...e.args);else if(e.mtype==="comp"){var n=new($comp.get(e.stype))(void 0,...e.args.slice(1));s===e.el.children.length?e.el.append(n.el):e.el.children[s].before(n.el),n.set(typeof t=="object"?t:e.args[0]||"value",t),r.addChild(n)}else if(e.mtype==="collection"){var n=new($comp.get(e.stype))(void 0,...e.args.slice(1));s===e.el.children.length?e.el.append(n.el):e.el.children[s].before(n.el),n.set(typeof t=="object"?t:e.args[0]||"value",t),r.addChild(n),e.collection.add(n,s)}else r.warn("binder handler (for): undefined main type ("+e.mtype+")")},"handleCreate"),D=d((r,e,t,s)=>{e.mtype==="sub"?e.el.children[t].remove():e.mtype==="comp"?e.el.children[t].$comp.remove():e.mtype==="collection"?(e.el.children[t].$comp.remove(),e.collection.remove(t)):r.warn("binder handler (for): undefined main type ("+e.mtype+")")},"handleDelete"),J=d((r,e,t,s,i)=>{e.mtype==="sub"?(e.el.children[s].remove(),r.view.appendSub(e.el,e.stype,s,t,...e.args)):e.mtype==="comp"?e.el.children[s].$comp.set(typeof t=="object"?t:e.args[0]||"value",t):e.mtype==="collection"&&e.collection.setOne(t,s)},"handleChange");var B={attr(r,e,t){t.view.attr(r.el,r.attr,$comp.temps.parseAttr.handle(r.temp,t,r.el,void 0))},html(r,e,t){r.el.innerHTML=e},text(r,e,t){r.node.textContent=$comp.temps.parseAttr.handle(r.temp,t,r.el,void 0)},attrBasic(r,e,t){t.view.attr(r.el,r.attr,e)},attrCall(r,e,t){t.view.attr(r.el,r.attr,t.call(r.fun,e,...r.args))},if(r,e,t){t.call(r.fun,r.el,r.condF(t,r.el,...r.prop.map(s=>t.get(s))),...r.args)},ifElse(r,e,t){var s=r.prop.map(i=>t.get(i));r.conds.some(i=>i.condF(t,r.el,...s)&&(t.call(i.fun,r.el,!0,...i.args)||!0))},for(r,e,t,s,i,n,o){r.mtype==="collection"&&!r.collection&&(r.collection=new $comp.CompCollection([],r.args[0])),o.arr?o["arr:empty"]?(r.el.replaceChildren(...r.onemptyEls),r.mtype==="collection"&&r.collection.remove(0,r.collection.comps.length)):o["arr:wasempty"]?(r.el.replaceChildren(),e.forEach((a,p)=>O(t,r,a,p,i))):(o["arr:patch"].forEach(a=>{if(a.type==="add"&&a.values.forEach((p,c)=>O(t,r,p,a.ind+c,i)),a.type==="delete")for(let p=a.count;p>0;p--)D(t,r,a.ind+p-1,i);a.type==="change"&&a.values.forEach((p,c)=>J(t,r,p,a.ind+c,i))}),r.type==="collection"&&r.collection.set(e)):(r.el.replaceChildren(...r.onemptyEls),i&&(i.meta["arr:old"]=void 0))}};var L={Array(r,e,t,s,i){var n,o=e.meta["arr:old"];return i.set?n={...i,"arr:wasempty":!0}:(!o||o.length===0)&&s.length!==0?n={...i,"arr:wasempty":!0}:i["arr:op"]?n={...i,"arr:patch":[{...i,type:i["arr:op"]}]}:s.length===0?n={...i,"arr:empty":!0}:n={...i,"arr:patch":$diff.simple(o,s).map(a=>({...a,values:s.slice(a.nind,a.nind+a.count)}))},e.meta["arr:old"]=[...s],n.arr=!0,n}};var C=class{constructor(e,t,s){if(!e?.isComp)throw new CompError("binder: component of type ("+e?.constructor?.name+"), expected (@componnt)");this.comp=e,this.binds={},this.sets={},this.opts={...this.constructor.defaults,...t},this.handlers=B,this.prehandlers=L,s.forEach(i=>this.add(i)),e.on("model:propag",this.patch.bind(this)),this.opts.setOnInit&&e.on("init",()=>this.fireSet())}patch(e,t,s,i,n,o,a){this.binds[s]&&((a.prehandle===void 0&&this.opts.prehandle||a.prehandle)&&(a=this.prehandle(i,n,o,a)),this.binds[s].forEach(p=>this.handlers[p.type](p,o,this.comp,n,i,s,a)))}prehandle(e,t,s,i){return s?.constructor?.name in this.prehandlers?this.prehandlers[s?.constructor?.name](this.comp,e,t,s,i):i}addB(e,t,s=!0,i=this.opts.prehandle){var n,o,a;if(!t?.el?.nodeType)throw new CompError("binder: element of type ("+el?.constructor?.type+"), expected (Element)");return Array.isArray(e)?e.forEach(p=>this.binds[p]?this.binds[p].push(t):this.binds[p]=[t]):this.binds[e]?this.binds[e].push(t):this.binds[e]=[t],Array.isArray(e)||([n,o]=this.comp.model.getLow(e)),s&&this.opts.setOnDefine&&(t.type in this.handlers?(i&&(a=this.prehandle(e,n,n,{})),this.handlers[t.type](t,n,this.comp,n,o,e,{...a,set:!0})):this.comp.warn("binder: undefined bind type ("+t.type+")")),this}addS(e,t,s=!0,i=this.opts.prehandle){var n,o,a;if(!t?.el?.nodeType)throw new CompError("binder: element of type ("+el?.constructor?.type+"), expected (Element)");return Array.isArray(e)?e.forEach(p=>this.sets[p]?this.sets[p].push(t):this.sets[p]=[t]):this.sets[e]?this.sets[e].push(t):this.sets[e]=[t],Array.isArray(e)||([n,o]=this.comp.model.getLow(e)),s&&this.opts.setOnDefine&&(t.type in this.handlers?(i&&(a=this.prehandle(e,n,n,{})),this.handlers[t.type](t,n,this.comp,n,o,e,{set:!0})):this.comp.warn("binder: undefined bind type ("+t.type+")")),this}remove(e,t){if(e||(this.binds[t]=[],this.sets[t]=[]),!e.nodeType)throw new CompError("binder: element of type ("+e?.constructor?.type+"), expected (Element)");if(t)this.binds[t]=this.binds[t].filter(s=>s.el!==e),this.sets[t]=this.sets[t].filter(s=>s.el!==e);else{for(let s in this.binds)this.binds[s]=this.binds[s].filter(i=>i.el!==e);for(let s in this.sets)this.sets[s]=this.sets[s].filter(i=>i.el!==e)}return this}fireSet(e,t={},s=this.opts.prehandle){if(!e){for(let o in this.sets)this.fireSet(o);return}var[i,n]=this.comp.model.getLow(e);return e in this.sets?(s&&(t=this.prehandle(n,i,i,t)),this.sets[e].forEach(o=>this.handlers[o.type](o,i,this.comp,void 0,n,e,{...t,set:!0,reset:!0}))):this.comp.warn("binder: undefined property ("+e+")"),this}clean(){for(let e in this.binds)this.binds[e]=this.binds[e].filter(t=>$doc.contains(t.el));for(let e in this.sets)this.sets[e]=this.sets[e].filter(t=>$doc.contains(t.el));return this}};d(C,"Binder"),l(C,"defaults",{setOnDefine:!0,setOnInit:!0,prehandle:!0});var u=class{class=this.constructor;constructor(e,t,s=[]){t=this.opts={...this.class.defaults,...t},this.id=typeof t.id=="function"?t.id():t.id,this.parent=null,$comp.addId(this,this.id),this.acts=t.acts,this.funs=this.class.funs,this.events=new w({},t.addUndefEvent,t.warn),t.eventNames.forEach(i=>this.events.add(i));for(let i in t.events)t.events[i].forEach(n=>this.events.on(i,n));if(this.onEventsInit(),this.model=new this.class.model(this,t.model,t.data),this.view=new this.class.view(this,t.view,e),this.binder=new this.class.binder(this,t.binder,t.binds),this.effects=new this.class.effects(this,t.effect),this.signal=new this.class.signal(this,t.signal,t.sChannels),this.children=[],!Array.isArray(s))throw new CompError("comp: children of type ("+s?.constructor?.name+"), expected (Array)");s.forEach(i=>this.addChild(i)),this.on("appended-to-parent",(i,n)=>this.parent=n&&n.trigger("init:child",this)),this.on("deleted-child",(i,n)=>this.children=this.children.filter(o=>o!==n)),this.waitingNb||this.init()}isComp=!0;isInited=!1;internal_waitingNb=0;get waitingNb(){return this.internal_waitingNb}set waitingNb(e){this.internal_waitingNb=e,e===0&&this.init()}init(){this.opts.walkChilds&&this.walk(),this.isInited=!0,this.trigger("init"),this.callSafe("init")}addChild(e){var t;if(!e)throw new CompError("comp: adding child of type ("+e?.constructor?.name+"), expected (@component)");if(e.isComp)t=e;else if(e.isCompClass)t=new e;else if(e.isopts)t=new($comp.get(e.type))(e.el,e.opts,e.children);else throw new CompError("comp: adding child of type ("+e.constructor.name+"), expected (@component)");return this.children.push(t),this.trigger("appended-child",e),t.trigger("appended-to-parent",this),this}onEventsInit(){}remove(){this.trigger("deleted"),this.parent&&this.parent.trigger("deleted-child",this),$comp.root===this&&$comp.events.trigger("delete-root",this)&&($comp.root=null),this.el.remove(),$comp.idmap[this.id]=void 0}warn(e){this.opts.warn&&console[this.opts.warn](e)}addEvent(e){return this.events.add(e),this}on(e,t){return this.events.on(e,t),this}off(e,t){return this.events.off(e,t),this}once(e,t){return this.events.once(e,t),this}hasEvent(e){return this.events.has(e)}trigger(e,...t){return this.events.trigger(e,this,...t),this}addAct(e){if(!e)throw new CompError("comp: undefined action");return this.acts.push(e),this}doAct(e){if(!e)throw new CompError("comp: undefined action");return this.opts.doAct?e.el?$comp.acts.do(this,{...e,el:this.view.$(e.el)}):$comp.acts.do(this,e):this.addAct(e),this}doAllActs(){this.acts.forEach(e=>$comp.doAct(this,e))}call(e,...t){var s=e.split(":",2);if(s.length===1){if(!(s[0]in this.funs))throw new CompError("comp: undefined function ("+s[0]+")");return this.funs[s[0]](this,...t)}return $comp.funNS[s[0]](s[1],this,!1,...t)}callSafe(e,...t){var s=e.split(":",2);return s.length===1?s[0]in this.funs?this.funs[s[0]](this,...t):void 0:$comp.funNS[s[0]](s[1],this,!0,...t)}addProp(e,t,s=!1){var i=this.model.add(e,t,s);return s?i:this}set(e,t,s=!1){var i=this.model.set(e,t,s);return s?i:this}get(e){return this.model.get(e)}deleteProp(e){return this.model.delete(e),this}has(e){return this.model.has(e)}addEffect(e,t){return this.effects.add(e,t),this}addSignal(e,t){return this.signal.add(e,t),this}walk(e,t=[]){return e?this.view.walk(this.view.$(e),t):this.view.walk([...this.el.children],t),this}addRef(e,t){return this.view.addRef(e,t),this}};d(u,"Comp"),l(u,"defaults",{id(){return Math.round(Math.random()*$comp.opts.maxCompRandId)},warn:"warn",addUndefEvent:!0,eventNames:["appended-to-parent","appended-child","init","delete","model:add","model:delete","model:propag","init:model","init:view","init:child","render","deleted","deleted-child","collection:added"],events:{},get acts(){return[]},doAct:!0,model:{},data:{},view:{},effects:{},signal:{},binder:{},binds:[],sChannels:[],walkChilds:!0}),l(u,"model",g),l(u,"view",v),l(u,"binder",C),l(u,"effects",A),l(u,"signal",y),l(u,"funs",{}),l(u,"isCompClass",!0);var I={propagAttrs:{"comp:say"(r,e,t){r.doAct({type:"comp:say",el:e,data:t})},"comp:sayo"(r,e,t){r.doAct({type:"comp:say",el:e,data:t}),e.removeAttribute("comp:sayo")},"comp:ref"(r,e,t){r.doAct({type:"comp:ref",el:e,name:t}),e.removeAttribute("comp:ref")},"comp:call"(r,e,t){JSON.parse(t).forEach(s=>r.doAct({type:"comp:call",el:e,fun:s[0],args:s.slice(1)})),e.removeAttribute("comp:call")}},unpropagAttrs:{"comp:this"(r,e,t){r.doAct({type:"comp:this",el:e,name:t}),e.removeAttribute("comp:this")},"comp:sub"(r,e,t){r.doAct({type:"comp:sub",el:e,data:JSON.parse(t)}),e.removeAttribute("comp:sub")},"comp:temp"(r,e){e.removeAttribute("comp:temp"),r.doAct({type:"comp:temp",el:e})}}};var R={handle(r,e,t){return t.forEach(s=>{if(s.startsWith("bind(")){var i,n=s.indexOf(")"),o=s.slice(s.indexOf("(")+1,n).split(","),a=s.slice(n+2);if(a.includes(":")&&([a,i]=a.split(":")),!this.methods[a])throw new CompError("bind:attrs: undefined method ("+a+")");this.methods[a](r,e,e.getAttribute(s),o,s,i?i.replace(/--./,p=>p[2].toUpperCase()):void 0)}}),!0},methods:{attr(r,e,t,s,i){JSON.parse(t).forEach(n=>r.doAct({type:"bind:attr",el:e,prop:s,attr:n})),e.removeAttribute(i)},"attr-temp"(r,e,t,s,i,n){r.doAct({type:"bind:attr-temp",attr:n,prop:s,el:e,temp:t}),e.removeAttribute(i)},"attr-call"(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"bind:attr-call",el:e,prop:s,attr:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},text(r,e,t,s,i){r.doAct({type:"bind:text",el:e,prop:s}),e.removeAttribute(i)},html(r,e,t,s,i){r.doAct({type:"bind:html",el:e,prop:s}),e.removeAttribute(i)},if(r,e,t,s,i){var n=JSON.parse(t);r.doAct({type:"bind:if",el:e,prop:s,condF:Function("comp","el",s.map(o=>o.replace(/\..*/,"")),n[0].includes(";")?n[0]:"return "+n[0]),fun:n[1],args:n.slice(2)}),e.removeAttribute(i)},"if-else"(r,e,t,s,i){var n=JSON.parse(t),o=s.map(a=>a.replace(/\..*/,""));r.doAct({type:"bind:if-else",el:e,prop:s,conds:n.map(a=>({condF:Function("comp","el",...o,a[0].includes(";")?a[0]:"return "+a[0]),fun:a[1],args:a.slice(2)}))}),e.removeAttribute(i)},for(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"bind:for",el:e,prop:s,mtype:n,stype:o[0],args:o.slice(1),onemptyEls:[...e.childNodes]}),e.removeAttribute(i)}}};var z={handle(r,e,t){return t.forEach(s=>{if(s.startsWith("set(")){var i,n=s.indexOf(")"),o=s.slice(s.indexOf("(")+1,n).split(","),a=s.slice(n+2);if(a.includes(":")&&([a,i]=a.split(":")),!this.methods[a])throw new CompError("set:attrs: undefined method ("+a+")");this.methods[a](r,e,e.getAttribute(s),o,s,i?i.replace(/--./,p=>p[2].toUpperCase()):void 0)}}),!0},methods:{attr(r,e,t,s,i){JSON.parse(t).forEach(n=>r.doAct({type:"set:attr",el:e,prop:s,attr:n})),e.removeAttribute(i)},"attr-temp"(r,e,t,s,i,n){r.doAct({type:"set:attr-temp",attr:n,prop:s,el:e,temp:t}),e.removeAttribute(i)},"attr-call"(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"set:attr-call",el:e,prop:s,attr:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},text(r,e,t,s,i){r.doAct({type:"set:text",el:e,prop:s}),e.removeAttribute(i)},html(r,e,t,s,i){r.doAct({type:"set:html",el:e,prop:s}),e.removeAttribute(i)},if(r,e,t,s,i){var n=JSON.parse(t);r.doAct({type:"set:if",el:e,prop:s,condF:Function("comp","el",s.map(o=>o.replace(/\..*/,"")),n[0].includes(";")?n[0]:"return "+n[0]),fun:n[1],args:n.slice(2)}),e.removeAttribute(i)},"if-else"(r,e,t,s,i){var n=JSON.parse(t),o=s.map(a=>a.replace(/\..*/,""));r.doAct({type:"set:if-else",el:e,prop:s,conds:n.map(a=>({condF:Function("comp","el",...o,a[0].includes(";")?a[0]:"return "+a[0]),fun:a[1],args:a.slice(2)}))}),e.removeAttribute(i)},for(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"set:for",el:e,prop:s,mtype:n,stype:o[0],args:o.slice(1),onemptyEls:[...e.childNodes]}),e.removeAttribute(i)}}};var W={handle(r,e,t){return t.forEach(s=>{if(s.startsWith("on(")){var i,n=s.indexOf(")"),o=s.indexOf(":"),a=s.slice(s.indexOf("(")+1,n).split(","),p=s.slice(n+1,o).split("."),c=s.slice(o+1);if(c.includes(":")&&([c,i]=c.split(":")),!this.methods[c])throw new CompError("on:attrs: undefined method ("+c+")");this.methods[c](r,e,e.getAttribute(s),a,s,p,i?i.replace(/--./,N=>N[2].toUpperCase()):void 0)}}),!0},methods:{call(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"on:call",el:e,events:s,modifs:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},set(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"on:set",el:e,events:s,modifs:n,prop:o[0],value:o[1]}),e.removeAttribute(i)},"set-fun"(r,e,t,s,i,n,o){var a=JSON.parse(t);r.doAct({type:"on:set-fun",el:e,events:s,modifs:n,prop:a[0],fun:o,args:a.slice(1)}),e.removeAttribute(i)},"set-attr"(r,e,t,s,i,n,o){r.doAct({type:"on:set-attr",el:e,events:s,modifs:n,prop:t,attr:o}),e.removeAttribute(i)},"set-attr-fun"(r,e,t,s,i,n,o){var a=JSON.parse(t);r.doAct({type:"on:set-attr-fun",el:e,events:s,modifs:n,prop:a[0],attr:a[1],fun:o,args:a.slice(2)}),e.removeAttribute(i)}}};var H={handlers:{"use:comp":I,"use:bind":R,"use:set":z,"use:on":W},curEl:null,curAttr:null,add(r,e){this.handlers[r]=e},walk(r,e,t=[]){if(!r?.isComp)throw new CompError("comp: component of type ("+r?.constructor?.name+"), expected (@component)");if(!e?.nodeType)throw new CompError("comp: element of type ("+e?.constructor?.name+"), expected (Element)");if(!e.hasAttribute("is:static")){this.curEl=e;var s=e.getAttributeNames(),i=!0;[...t,...s.filter(n=>n.startsWith("use")&&!t.includes(n))].forEach(n=>{let o=this.handlers[n];if(o.handle)return i=o.handle(r,e,s)||i;s.forEach(a=>{this.curAttr=a,a in o.propagAttrs&&o.propagAttrs[a](r,e,e.getAttribute(a)),a in o.unpropagAttrs&&(o.unpropagAttrs[a](r,e,e.getAttribute(a)),i=!1)})}),i&&[...e.children].forEach(n=>n.$comp?n.$comp.walk():this.walk(r,n))}},clean(r){if(!r?.nodeType)throw new CompError("comp: element of type ("+r?.constructor?.name+"), expected (Element)");r.getAttributeNames().forEach(e=>{e.startsWith("use")&&r.removeAttribute(e)}),[...r.children].forEach(e=>this.clean(e))}};var U={"comp:this"(r,e){var{el:t,name:s}=e;t.forEach(i=>{let n=new($comp.get(s))(i);r.addChild(n)})},"comp:say"(r,e){console.log([e.data||"hallo",e?.el?.[0],r])},"comp:sub"(r,e){r.view.setSub(e.el,...e.data)},"comp:ref"(r,e){r.view.addRef(e.name,e.el)},"comp:call"(r,e){r.call(e.fun,e.el[0],...e.args)},"comp:temp"(r,e){[...e.el[0].children].forEach(t=>r.walk(t,["use:bind","use:set","use:on"]))}};var _={"bind:attr"(r,e){r.binder.addB(e.prop,{type:"attrBasic",el:e.el[0],attr:e.attr})},"bind:attr-temp"(r,e){r.binder.addB(e.prop,{type:"attr",el:e.el[0],attr:e.attr,temp:$comp.temps.parseAttr(e.temp,r,e.el[0])})},"bind:attr-call"(r,e){r.binder.addB(e.prop,{type:"attrCall",el:e.el[0],attr:e.attr,fun:e.fun,args:e.args})},"bind:text"(r,e){var t=e.el[0];t.childNodes.forEach(s=>{if(s.nodeType===s.TEXT_NODE){var i=$comp.temps.parseAttr(s.textContent,r,t);r.binder.addB(e.prop,{type:"text",el:t,node:s,temp:i})}})},"bind:html"(r,e){r.binder.addB(e.prop,{type:"html",el:e.el[0]})},"bind:if"(r,e){r.binder.addB(e.prop,{type:"if",el:e.el[0],prop:e.prop,condF:e.condF,fun:e.fun,args:e.args})},"bind:if-else"(r,e){r.binder.addB(e.prop,{type:"ifElse",el:e.el[0],prop:e.prop,conds:e.conds})},"bind:for"(r,e){r.binder.addB(e.prop,{type:"for",el:e.el[0],mtype:e.mtype,stype:e.stype,args:e.args,onemptyEls:e.onemptyEls})}};var K={"set:attr"(r,e){r.binder.addS(e.prop,{type:"attrBasic",el:e.el[0],attr:e.attr})},"set:attr-temp"(r,e){r.binder.addS(e.prop,{type:"attr",el:e.el[0],attr:e.attr,temp:$comp.temps.parseAttr(e.temp,r,e.el[0])})},"set:attr-call"(r,e){r.binder.addS(e.prop,{type:"attrCall",el:e.el[0],attr:e.attr,fun:e.fun,args:e.args})},"set:text"(r,e){var t=e.el[0];t.childNodes.forEach(s=>{if(s.nodeType===s.TEXT_NODE){var i=$comp.temps.parseAttr(s.textContent,r,t);r.binder.addS(e.prop,{type:"text",el:t,node:s,temp:i})}})},"set:html"(r,e){r.binder.addS(e.prop,{type:"html",el:e.el[0]})},"set:if"(r,e){r.binder.addS(e.prop,{type:"if",el:e.el[0],prop:e.prop,condF:e.condF,fun:e.fun,args:e.args})},"set:if-else"(r,e){r.binder.addS(e.prop,{type:"ifElse",el:e.el[0],prop:e.prop,conds:e.conds})},"set:for"(r,e){r.binder.addS(e.prop,{type:"for",el:e.el[0],mtype:e.mtype,stype:e.stype,args:e.args,onemptyEls:e.onemptyEls})}};var $=d((r,e,t,s,i,...n)=>{var o=i.includes("preventdefaults"),a=i.includes("once"),p=i.includes("capture"),c=i.includes("passive"),N=i.includes("stoppropagation"),Y=i.includes("self"),Z=i.includes("trusted"),j=d(b=>{Z&&!b.isTrusted||Y&&b.target!==e||(o&&b.preventDefault(),N&&b.stopPropagation(),t(r,e,b,...n))},"fn");s.forEach(b=>e.addEventListener(b,j,{once:a,capture:p,passive:c}))},"handleListen");var X={"on:call"(r,e){$(r,e.el[0],t=>r.call(e.fun,...e.args),e.events,e.modifs)},"on:set"(r,e){$(r,e.el[0],t=>r.set(e.prop,e.value),e.events,e.modifs)},"on:set-fun"(r,e){$(r,e.el[0],t=>r.model.setFn(e.prop,e.fun,!0,e.value,e.args),e.events,e.modifs)},"on:set-attr"(r,e){$(r,e.el[0],t=>r.set(e.prop,r.view.attr(e.el,e.attr)),e.events,e.modifs)},"on:set-attr-fun"(r,e){$(r,e.el[0],t=>r.model.setFn(e.prop,e.fun,!1,r.view.attr(e.el,e.attr),...e.args),e.events,e.modifs)}};var q={actions:{...U,..._,...K,...X},add(r,e){if(typeof e!="function")throw new CompError("comp: action of type ("+(e?.constructor?.name||e)+"), expected (Function)");this.actions[r]=e},do(r,e){if(!r?.isComp)throw new CompError("comp: component of type ("+r?.constructor?.name+"), expected (@component)");if(!e?.type||!(e.type in this.actions))throw new CompError("comp: undefined action type ("+e?.type+")");this.actions[e.type](r,e)}};var G={mg(r,e,t,s,...i){if(!(t&&r in e.model.funs))return e.model.getFn(s,r,...i)},m(r,e,t,...s){var i=e.model.funs[r];if(i)return i(e.model,...s);if(t)return;throw new CompError("model: undefined function ("+r+")")},v(r,e,t,s,...i){if(!(t&&r in e.view.funs))return e.view.call(s,r,...i)}};var f=d((r,e,t,s)=>{var i=r.split(f.regex),n=[];return i.forEach(o=>{if(o!=="")if(o.startsWith("{")){if(o.startsWith("{{#"))return n.push({type:"val",value:Function("comp","model","el","value",o.includes(";")?o.slice(3,-2):"return "+o.slice(3,-2))(e,e.model,t,s)});if(o.startsWith("{{"))return n.push({type:"exp",fun:Function("comp","model","el","value",o.includes(";")?o.slice(2,-2):"return "+o.slice(2,-2))});if(o.startsWith("{$"))return n.push(f.parseFun(o.slice(2,-1)));if(o.startsWith("{@"))return n.push({type:"vNS",value:o.slice(2,-1).split(":")});n.push({type:"prop",name:o.slice(1,-1)})}else n.push({type:"val",value:o})}),n},"parse");f.regex=/({{[^{]+}}|{[^{]+})/;f.parseArg=r=>{if(r[0]==="@")return r.slice(1).split(":");if(r==="true")return!0;if(r==="false")return!1;if(r==="null")return null;if(r!=="undefined"){var e=Number(r);return isNaN(e)?r:e}};f.parseArgs=r=>r.split(",").map(e=>e.trim()).map(f.parseArg);f.parseFun=r=>{var e=r.trim().split("(");return{type:"call",fun:e[0].trim(),args:f.parseArgs(e[1].trimEnd().slice(0,-1))}};f.valueNS={attr(r,e,t,s){return r.view.attr(e,s[1])},prop(r,e,t,s){return r.get(s[1])}};f.handle=(r,e,t,s)=>{if(!e?.isComp)throw new CompError("parse attr: component of type ("+e?.constructor?.name+"), expected (@component)");if(!t?.nodeType)throw new CompError("parse attr: element of type ("+t?.constructor?.name+"), expected (Element)");var i=typeof r=="string"?f(r,e,t,s):r;return i.map(n=>{if(n.type==="val")return n.value;if(n.type==="prop")return e.get(n.name);if(n.type==="exp")return n.fun(e,e.model,t,s);if(n.type==="call")return f.handleFun(n,e,t,s);if(n.type==="vNS")return f.valueNS[n.value[0]](e,t,s,n.value);throw new CompError("parse attr: undefined attribute expression type ("+n.type+")")}).join("")};f.handleFun=(r,e,t,s)=>e.call(r.fun,...r.args.map(i=>Array.isArray(i)?f.valueNS[i[0]](e,t,s,i):i));var Q={temps:{},subs:{},add(r,e){r in this.temps&&$comp.opts.warn&&console[$comp.opts.warn]("comp: adding defined template ("+r+")");var t;typeof e=="string"?(t=$el(e),this.temps[r]=()=>({els:t.map(s=>s.cloneNode(!0)),acts:[]})):e?.nodeType===1?this.temps[r]=()=>({els:[...e.cloneNode(!0).childNodes],acts:[]}):this.temps[r]=e,$comp.events.trigger("temp-added",r,this.temps[r])},has(r){return r in this.temps},get(r){if(!(r in this.temps))throw new CompError("comp: undefined template");return this.temps[r]},getLazy(r,e){var t=d(s=>{debugger;s===e&&($comp.events.off("temp-added",t),r.render(),r.comp.waitingNb-=1)},"fn");this.temps[e]?t(e):$comp.events.on("temp-added",t)},addSub(r,e){r in this.subs&&$comp.opts.warn&&console[$comp.opts.warn]("comp: adding defined sub ("+r+")");var t;typeof e=="string"?(t=$el(e),this.subs[r]={$isSub:!0,fn(){return{el:t.map(s=>s.cloneNode(!0)),acts:[]}}}):e?.nodeType===1?this.subs[r]={$isSub:!0,fn(){return{el:[...e.cloneNode(!0).childNodes],acts:[]}}}:this.subs[r]=e},hasSub(r){return r in this.subs},getSub(r){if(!(r in this.subs))throw new CompError("comp: undefined sub");return this.subs[r]},parseAttr:f};var S=class{constructor(e=[],t="value"){if(!Array.isArray(e))throw new CompError("collection: comps of type ("+e?.constructor?.name+"), expected (Array)");this.comps=e,this.propName=t,e.forEach(s=>s.trigger("collection:added",this))}add(e,t){if(t>this.comps.length)throw new CompError("collection: index ("+t+") greater than length ("+this.comps.length+")");return this.comps.splice(t,0,e),e.trigger("collection:added",this),this}get(e){return this.comps[e]}get length(){return this.comps.length}set(e){return Array.isArray(e)?(e.length!==this.comps.length&&$comp.warn("collection: values length ("+e.length+") is not equal to length ("+this.comps.length+")"),e.forEach((t,s)=>this.comps[s]&&this.comps[s].set(typeof t=="object"?t:this.propName,t))):$comp.warn("collection: values of type ("+e?.constructor?.name+"), expected (@component)"),this}setOne(e,t){return this.comps.length<=t?$comp.warn("collection: index ("+t+") greater than length ("+this.comps.length+")"):this.comps[t].set(typeof e=="object"?e:this.propName,e),this}remove(e,t=1){if(e>=this.comps.length)throw new CompError("collection: index ("+e+") greater than length ("+this.comps.length+")");this.comps.splice(e,t)}};d(S,"CompCollection");var h={currentComp:null,compStack:[],push(r){if(!r.isComp)throw new CompError("comp: component of type ("+r?.constructor?.name+"), expected (@component)");this.compStack.push(r),this.currentComp=r},pop(){this.compStack.pop(),this.currentComp=this.compStack.length===0?null:this.compStack[this.compStack.length-1]},getCur(r=!0){if(this.currentComp)return this.currentComp;if(r)throw new CompError("functional: component stack length is 0")},enableFor(r){return(e,...t)=>{this.push(e),r(...t),this.pop()}},currentClass:null,createComp(r,e,t=Comp){if(typeof r!="function")throw new CompError("functional: createFn of type ("+r?.constructor?.name+"), expected (Function)");if(typeof e!="function")throw new CompError("functional: initFn of type ("+e?.constructor?.name+"), expected (Function)");var s=d(class extends t{init(){h.push(this);var o=e();o&&this.set(o),h.pop(),super.init()}static funs={...t.funs};static defaults={...t.defaults}},"FComp");this.currentClass=s;var i=r();return s.defaults.view.temp=i,this.currentClass=null,s},useClass(){if(!this.currentClass)throw new CompError("functional: currentClass is not defined");return this.currentClass},useDefaults(){return this.useClass().defaults},setFun(r,e){this.useClass().funs[r]=this.enableFor(e)},useComp(){return this.getCur()},useStore(){return this.getCur().model.toProxy()},useState(r,e){var t=this.getCur(),s=!1;return e&&!t.has(r)&&t.set(r,e)&&(s=!0),[s?e:t.get(r),i=>t.set(r,i),()=>t.get(r)]},useEffect(r,e){this.getCur().addEffect(r,typeof e=="string"?e:this.enableFor(e))},useEvent(r,e){this.getCur().on(r,this.enableFor(e))},useTrigger(r,...e){this.getCur().trigger(r,...e)},useSignal(r,e){this.getCur().addSignal(r,e)},useCall(r,...e){return this.getCur().call(r,...e)},useCallSafe(r,...e){return this.getCur().callSafe(r,...e)},useRef(r){return this.getCur().refs[r]},use$(...r){return this.getCur().view.$(...r)},useEl(){return this.getCur().el},useAttr(r,e,t){return this.getCur().view.attr(r,e,t)}};for(let r in h)h[r]?.bind&&(h[r]=h[r].bind(h));var E=class{isComp=!0;constructor(e,...t){this.name=e,this.args=t,this.fn=this.handle.bind(this),$comp.events.on("comp-added",this.fn)}trigger(e,...t){if(e==="appended-to-parent")this.parent=t[0];else if(e==="deleted-child")$comp.events.off("comp-added",this.fn);else throw new CompError("lazy comp: undefined event ("+e+")")}handle(e,t){if(e===this.name){if($comp.events.off("comp-added",this.fn),!this.parent)throw new CompError("lazy comp: undefined parent");var s=new t(...this.args);this.parent.children[this.parent.children.indexOf(this)]=s,s.trigger("appended-to-parent",this.parent)}}};d(E,"LazyComp"),l(E,"isCompClass",!0);var V={add(){throw new CompError("lazy comp manager: unsupported method (add)")},has(){throw new CompError("lazy comp manager: unsupported method (has)")},get(r){return $comp.has(r)?$comp.get(r):re(r)}},re=d(r=>new Proxy(E,{get(e,t){return e[t]},construct(e,t){return new e(r,...t)}}),"createProxy");var x={isComp:!0,opts:{warn:"warn",maxCompRandId:65536},warn(r){this.opts.warn&&console[this.opts.warn](r)},comps:{basic:u},compMans:{lazy:V},add(r,e){if(!e?.isCompClass)throw new m("comp: adding class of type ("+e?.constructor?.name+"), expected (@component)");var t=r.split(":");if(t.length!==1){if(!this.compMans[t[0]])throw new m("comp: undefined component manager ("+t[0]+")");return this.compMans[t[0]].add(t[1])}r in this.comps&&this.warn("comp: adding defined component ("+r+")"),this.comps[r]=e,this.events.trigger("comp-added",r,e)},get(r){if(r?.isCompClass)return r;if(r?.isComp)return r.class;var e=r.split(":");if(e.length!==1){if(!this.compMans[e[0]])throw new m("comp: undefined component manager ("+e[0]+")");return this.compMans[e[0]].get(e[1])}var t=this.comps[r];if(t)return t;throw new m("comp: component of type ("+t?.constructor?.name+"), expected (@component)")},has(r){var e=r.split(":");return e.length===1?r in this.comps:this.compMans[e[0]].has(e[1])},events:new w,attrs:H,acts:q,funNS:G,func:h,temps:Q,walk(r,e){this.attrs.walk(r,e)},doAct(r,e){this.acts.do(r,e)},root:null,setRoot(r,e="basic",...t){if(!r?.nodeType)throw new m("comp: element of type ("+r?.constructor?.type+"), expected (Element)");return this.root=e.isComp?e:new(this.get(e))(r,...t),this.events.trigger("set-root",this.root),this.root},idmap:{},addId(r,e){r?.isComp?this.idmap[e]?this.warn("comp: defined id ("+e+")"):(this.idmap[e]=r)&&this.events.trigger("id-added"):this.warn("comp: component of type ("+r?.constructor?.name+"), expected (@component)")},getById(r,e=!0){var t=this.idmap[r];if(!t&&e)throw new m("comp: undefined id ("+r+")");return t},on(r,e){this.events.on(r,e)},off(r,e){this.events.off(r,e)},trigger(r,...e){this.events.trigger(r,this,...e)},addProp(r,e){return this.model.add(r,e,!0)},setProp(r,e){return this.model.set(r,e,!0)},getProp(r,e=!1){return this.model.get(r,e)},deleteProp(r){return this.model.delete(r)},hasProp(r){return this.model.has(r)},addEffect(r,e){this.effect.add(r,e)},addSignal(r,e){this.signal.add(r,e)},classes:{comp:u,event:w,error:m,model:g,view:v,binder:C,effect:A,signal:y,collection:S,lazyComp:E},Comp:u,EventEmmiter:w,CompError:m,Model:g,View:v,CompCollection:S,Binder:C,EffectEmmiter:A,Signal:y,LazyComp:E};globalThis.$comp=x;globalThis.CompError=m;globalThis.Comp=u;["comp-added","set-root","delete-root","id-added","temp-added","model:add","model:delete","model:propag","init:model"].forEach(r=>x.events.add(r));Object.assign(x,{model:new g(x,{},{}),signal:new y(x,{},[]),effect:new A(x,{})});u.defaults.warn=x.opts.warn;var Jt=x,Bt=h.createComp,Lt=h.enableFor,It=h.useClass,Rt=h.useDefaults,zt=h.setFun,Wt=h.useComp,Ht=h.useStore,Ut=h.useState,_t=h.useEffect,Kt=h.useEvent,Xt=h.useTrigger,qt=h.useSignal,Gt=h.useCall,Qt=h.useCallSafe,Vt=h.useRef,Yt=h.use$,Zt=h.useEl,jt=h.useAttr;})();
