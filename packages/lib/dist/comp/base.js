var _=Object.defineProperty;var ge=(t,e,r)=>e in t?_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var d=(t,e)=>_(t,"name",{value:e,configurable:!0});var y=(t,e,r)=>(ge(t,typeof e!="symbol"?e+"":e,r),r);var h=class extends Error{constructor(e="comp: empty"){var r=e.indexOf(":");super(e.slice(r+1).trim()),this.name=e.slice(0,r)}};d(h,"CompError");var w=d((t,e,r="comp")=>{if(typeof t!="function")throw new h(`${r}: ${e} of type (${t?.constructor?.name}), expected (Function)`)},"checkfn"),c=d((t,e,r="comp")=>{if(typeof t!="string")throw new h(`${r}: ${e} of type (${t?.constructor?.name}), expected (String)`)},"checkstr"),O=d((t,e,r="comp")=>{if(!Array.isArray(t))throw new h(`${r}: ${e} of type (${t?.constructor?.name}), expected (Array)`)},"checkarr"),R=d((t,e,r,s=0)=>{if(typeof t!="number")throw new h(`${r}: ${e} of type (${t?.constructor?.name}), expected (Number)`);if(!Number.isInteger(t)||t<s)throw new h(`${r}: ${e} is (${t}), expected positive integer`)},"checkpInt"),$=d((t,e="comp",r="el")=>{if(t?.nodeType!==1)throw new h(`${e}: ${r} of type (${t?.constructor?.type}), expected (Element)`)},"checkel"),E=d((t,e="comp",r="component")=>{if(!t?.isComp)throw new h(`${e}: ${r} of type (${t?.constructor?.name}), expected (@component)`)},"checkcomp"),z=d((t,e="component",r="comp")=>{if(!t?.isCompClass)throw new h(`${r}: ${e} of type (${t?.name||t?.constructor?.name}), expected (@component)`)},"checkCompClass"),I=d((t,e)=>{if(!t?.isDataProvider)throw new h(`${e}: provider of type (${t?.constructor?.name}), expected (@DataProvider)`)},"checkDataProv");var F=class{constructor(e={},r=!0,s="warn"){this.events=e,this.warn=s,this.addUndef=r}add(e){return c(e,"name","event"),e in this.events&&this.warn&&console[this.warn]("event: adding defined event ("+e+")"),this.events[e]=[],this}has(e){return c(e,"name","event"),e in this.events}on(e,r){if(typeof e=="object"){for(let s in e)this.on(s,e[s]);return this}return c(e,"name","event"),w(r,"handler","event"),e in this.events?this.events[e].push(r):this.addUndef?this.events[e]=[r]:this.warn&&console[this.warn]("event: udefined event ("+e+")"),this}off(e,r){return c(e,"name","event"),w(r,"handler","event"),e in this.events?r?this.events[e].splice(this.events[e].indexOf(r),1):this.events[e]=[]:this.warn&&console[this.warn]("event: udefined event ("+e+")"),this}once(e,r){c(e,"name","event"),w(r,"handler","event");var s=d((...i)=>{r(...i),this.off(e,s)},"onceFn");return this.on(e,s)}trigger(e,...r){return c(e,"name","event"),e in this.events?this.events[e].forEach(s=>s(...r)):this.warn&&console[this.warn]("event: udefined event ("+e+")"),this}};d(F,"EventEmmiter");var B=d((t,e,r,s)=>t.comp.warn("model fn ("+r+"): "+s+" of type ("+e?.constructor?.name+"), expected (Array)"),"warnNotArray"),H=d((t,e,r,s)=>t.comp.warn("model fn ("+e+"): index ("+r+") greater than length ( "+s+" )"),"warnIndGT"),U={toStr(t,e){return String(e)},toJSON(t,e){return JSON.stringify(e)},toBase64(t,e){return btoa(e)},toNb(t,e){return Number(e)},toggle(t,e,r){if(Array.isArray(r)){r.length===0&&t.comp.warn("model fn (toggle): checklist is empty");var s=r.indexOf(e)+1;return r[s>r.length-1?0:s]}else return B(t,r,"toggle","checklist"),e},toggleBl(t,e){return!e},inc(t,e,r=1){var s=Number(e);return isNaN(s)?0:s+(r-0)},incMinMax(t,e,r=0,s=60,i=1){var n=Number(e);return isNaN(n)?r:Math.max(Math.min(n+i,s),r)},incCircular(t,e,r=0,s=60,i=1){var n=Number(e);if(isNaN(n))return r;var o=n+i,a=s-r;return(o-r)%a+(o<r?r+a:r)},random(t,e,r=0,s=100,i=!0){var n=Math.random()*(s-r)+r;return i?Math.round(n):n},min(t,e,r=0){var s=Number(e);return isNaN(s)?r:Math.min(s,r)},max(t,e,r=100){var s=Number(e);return isNaN(s)?r:Math.max(s,r)},minMax(t,e,r=0,s=100){var i=Number(e);return isNaN(i)?r:Math.max(r,Math.min(i,s))},circular(t,e,r=0,s=60){var i=Number(e);if(isNaN(i))return r;var n=s-r;return(i-r)%n+(i<r?r+n:r)},round(t,e){return Math.round(Number(e))},push(t,e,r){return e?.push?(e.push(r),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:e.length-1,values:[r]}}):(B(t,e,"push","property"),e)},pop(t,e){return e?.pop?e.length===0?e:(e.pop(),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:e.length}}):(B(t,e,"pop","property"),e)},unshift(t,e,r){return e?.unshift?(e.unshift(r),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:0,values:[r]}}):(B(t,e,"unshift","property"),e)},shift(t,e){return e?.shift?e.length===0?e:(e.shift(),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:0}}):(B(t,e,"shift","property"),e)},arrSet(t,e,r,s=0){return Array.isArray(e)?(e.length<=s&&H(t,"arrSet",s,e.length),e[s]=r,{$hasMeta:!0,value:e,meta:{"arr:op":"change",force:!0,ind:s,values:[r]}}):(B(t,e,"arrSet","property"),e)},arrIns(t,e,r,s=0){return Array.isArray(e)?(e.length<s&&H(t,"arrIns",s,e.length),e.splice(s,0,r),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:s,values:[r]}}):(B(t,e,"arrSet","property"),e)},arrDel(t,e,r=0){return Array.isArray(e)?(e.length<=r&&H(t,"arrDel",r,e.length),e.splice(r,1),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:r}}):(B(t,e,"arrSet","property"),e)}};var ye={set(t,e,r){return t.set(e,r)},get(t,e){return t.get(e)},has(t,e){return t.has(e)},deleteProperty(t,e){return t.delete(e)},ownKeys(t){return t.getAllKeys()}},q=d(t=>new Proxy(t,ye),"createProxy");var C=class{class=this.constructor;constructor(e,r={},s={}){I(e,"model"),this.comp=e,this.funs=this.class.funs,this.opts={...this.class.defaults,...r},w(this.opts.doReact,"doReact","model"),this.data={};for(let i in s)this.addLow(i,s[i]);this.init(),this.comp.trigger("init:model",this)}init(){}addLow(e,r){if(r?.$hasMeta)var s={...this.opts.propObj,...r,name:e};else var s={...this.opts.propObj,value:r,name:e};if(s.meta={...s.meta},s.init&&w(s.init,"initFn","model"),s.setter&&w(s.init,"setter","model"),s.getter&&w(s.init,"getter","model"),this.data[e])if(this.comp.warn("model: adding defined property ("+e+")"),this.opts.addDef)this.data[e]=s;else return;else this.data[e]=s;return s.init&&s.init(this.comp,s),this.comp.trigger("model:add",this,e,s),s}add(e,r,s=!1){var i=this.addLow(e,r);return i&&i.isReactive&&this.opts.react&&this.react(e,i),s?i:this}react(e,r=this.data[e],s,i=r.value,n={}){r?(n.force===!0||this.opts.doReact(s,i))&&this.comp.trigger("model:change",this,e,r,s,i,n):this.comp.warn("model: reacting to undefined property ("+e+")")}get(e,r=!1){var s=this.data[e];return s||this.comp.warn(`model: getting undefined property (${e})`),r?s:s?.getter?s.getter(comp,s):s?.value}setLow(e,r){var s=this.data[e],i=s?.value;return s?s?.setter?r=s.setter(comp,r):s.value=r:s=this.addLow(e,r),[s,i,r]}set(e,r,s=!1,i={}){if(typeof e=="object"){for(let l in e)this.set(l,e[l]);return this}var[n,o,a]=this.setLow(e,r);return n.isReactive&&this.opts.react&&this.react(e,n,o,a,i),s?n:this}getFn(e,r,...s){var i=typeof r=="function"?r:this.funs[r];if(!i)throw new h("model: undefined function ("+r+")");var n=i(this,this.get(e),...s);return n?.$hasMeta?n.value:n}setFn(e,r,s=!0,...i){var n=typeof r=="function"?r:this.funs[r];if(!n)throw new h("model: undefined function ("+r+")");var o=s?n(this,this.get(e),...i):n(this,...i),a=o?.$hasMeta?o.value:o;return this.set(e,a,!1,o?.meta),this}has(e){return!!this.data[e]}delete(e){return this.data[e]===void 0?!1:(this.data[e]=void 0,this.comp.trigger("model:delete",this,e),!0)}getAllKeys(){return Object.keys(this.data).filter(e=>this.data[e]!==void 0)}toProxy(){return q(this)}toObj(){var e={};for(let r in this.data)e[r]=this.get(r);return e}toJSON(){return JSON.stringify(this.toObj())}};d(C,"Model"),y(C,"defaults",{addDef:!1,propObj:{$hasMeta:!0,meta:{},isReactive:!0,name:""},react:!0,doReact:(e,r)=>e!==r}),y(C,"funs",U);var K={$subInd(t){for(var e=t.$subEl?t.$subEl:t;!e.$comp&&!e.$isSub;)e=e.parentElement;return e.$comp?-1:(t.$subEl=e,[...e.parentElement.children].indexOf(e))}};var G={show(t,e){t.forEach(r=>r.style.display=e?"":"none")}};var X=d((t,e)=>{if(!(t instanceof Node))throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (Node)`)},"checknode"),Q=d((t,e)=>{if(typeof t!="string")throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (String)`)},"checkstr");var Y=d((t,e)=>{if(!Array.isArray(t))throw new TypeError(`dom: ${e} of type (${t?.constructor?.name}), expected (Array)`)},"checkarr");var Z=d(t=>(t.forEach((e,r)=>{if(!(e instanceof Node))throw new TypeError(`dom: element at index (${r}) of type (${e?.constructor?.name}), expected (Element)`)}),t),"checkEls"),we=/[a-z]/,Ae=d((t,e=document,r)=>{if(typeof t=="string"){if(t[0]?.match(we))return[be(t,e instanceof Node?[]:e,r)];if(t[0]==="<"){let s=document.createElement("div");return s.innerHTML=t,Array.from(s.children)}return X(e,"root"),Array.from(e.querySelectorAll(t))}if(t instanceof Element)return[t];if(Array.isArray(t))return Z(t);if(t?.length!==void 0)return Z(Array.from(t));throw new TypeError(`dom: a of type (${t?.constructor?.name}), expected (String) or (Element) or (ArrayLike)}`)},"$el"),be=d((t,e={},r=[])=>{Q(t,"tag"),Y(r,"children");var s=document.createElement(t);for(let i in e){let n=e[i];if(i==="text")s.innerText=n;else if(i==="classList")s.classList=Array.isArray(n)?n.join(" "):n;else if(i==="style")Object.assign(s.style,n);else if(i==="attr")for(let o in n)s.setAttribute(o,n[o]);else if(i==="events")for(let o in n)s.addEventListener(o,n[o]);else s[i]=n}return s.append(...r),s},"create");var L=Ae;var S=class{class=this.constructor;constructor(e,r={},s){E(e,"view"),this.comp=e;var i=this.opts={...this.class.defaults,...r};c(i.tempAppendMode,"tempAppendMode","view"),s=s?.nodeType===1?s:this.$(i.el)[0],s.$comp=e,this.el=s,this.comp.el=s,this.attrs=this.class.attrs,this.funs=this.class.funs,this.subs=i.subs,this.subs={};for(let o in i.subs){let a=i.subs[o];this.subs[o]=a.$isSub?a:this.$(a)[0]}this.refs={};var n=i.refs;for(let o in n)this.refs[o]=this.$(n[o]);this.comp.refs=this.refs,i.lazyTemp?(this.comp.waitingNb++,$comp.temps.getLazy(this,i.temp)):this.render(),e.trigger("init:view",this)}$(e,r=this.el){return L(e,r)}render(){var e=this.opts.temp,r=this.el,s,i=[],n=this.opts.tempAppendMode;if(typeof e=="string"?e[0]==="<"?s=this.$(e):{els:s,acts:i=[]}=$comp.temps.get(e)(this):e.nodeType===1?s=e.cloneNode(!0).childNodes:{els:s="",acts:i=[]}=e(this),n==="replace")r.replaceChildren(...s);else if(n==="append")r.append(...s);else if(n==="prepend")r.prepend(...s);else throw new h("view: undefined append mode ("+n+")");return i.forEach(o=>this.comp.doAct(o)),this.comp.trigger("render",this),this}walk(e,r=[]){return $comp.attrs.walk(this.comp,e,r),this}addRef(e,r){c(e,"name","view");var s=this.$(r);return s.length===0?this.comp.warn("view: no element with specific selector ("+r+")"):this.refs[e]?this.refs[e].push(...s):this.refs[e]=s,this}attr(e,r,s){c(r,"name","view");var i=this.$(e);if(s===void 0)return r in this.attrs?this.attrs[r](i[0]):r in i[0]?i[0][r]:i[0].getAttribute(r);i.forEach(n=>{r in this.attrs?this.attrs[r](n,s):r in n?n[r]=s:n.setAttribute(r,s)})}call(e,r,...s){if(c(r,"name","view"),r in this.funs)return this.funs[r](this.$(e),...s);this.comp.warn("view: undefined function ("+r+")")}createSub(e,...r){c(e,"name","view");var s=this.subs[e],i,n=[];if(!s)throw new h("view: undefined sub ("+e+")");return s.$isSub?{el:i,acts:n}=s.fn(this,0,...r):i=s[0].cloneNode(!0),(!("dowalk"in s)||s.dowalk)&&this.walk(i),n?.forEach?.(o=>this.comp.doAct(o)),i}appendSub(e,r,s=-1,...i){return R(s,"ind","view",-1),this.$(e).forEach(n=>{var o=this.createSub(r,...i);n.$isSub=!0,s===-1||s===n.children.length?n.append(o):s===0?n.prepend(o):n.children[s].before(o)}),this}setSub(e,r,s="append",...i){c(r,"name","view"),c(s,"appendMode","view");var n=this.subs[r],o,a=[],l;if(!n)throw new h("view: undefined sub ("+r+")");return this.$(e).forEach(p=>{n.$isSub?{el:l,acts:a}=n.fn(this,1,p,...i):l=n.cloneNode(!0);var v=l.children;if(s==="append")p.append(...v);else if(s==="prepend")p.prepend(...v);else if(s==="replace")p.replaceChildren(...v);else throw new h("view: undefined append mode ("+s+")");(!("dowalk"in n)||n.dowalk)&&Array.from(p.children).forEach(u=>this.walk(u)),a?.forEach?.(u=>this.comp.doAct(u))}),this}};d(S,"View"),y(S,"defaults",{tempAppendMode:"append",temp:"<span></span>",lazyTemp:!1,el:"<div></div>",subs:{},refs:{}}),y(S,"attrs",K),y(S,"funs",G);var M=class{constructor(e,r){I(e,"effect"),this.comp=e,this.effects={...r},e.on("model:change",this.patch.bind(this))}patch(e,r,s,i,n,o,a){this.effects[s]&&this.effects[s].forEach(l=>typeof l=="string"?e.call(l,o,n,i,s,a):l(e,o,n,i,s,a))}add(e,r){if(typeof r!="function"&&typeof r!="string"&&w(r,"fn","effect"),Array.isArray(e)){var s=d(i=>{var n=e.map(o=>i.get(o));typeof r=="string"?i.call(r,...n):r(...n)},"nfn");return e.forEach(i=>this.add(i,s)),this}return c(e,"name","effect"),e in this.effects?this.effects[e].push(r):this.effects[e]=[r],this}remove(e,r){return c(e,"name","effect"),r?this.effects[e]?this.effects[e]=this.effects[e].filter(s=>s!==r):this.comp.warn("effect: undefined property ("+e+")"):this.effects[e]?this.effects[e]=void 0:this.comp.warn("effect: undefined property ("+e+")"),this}};d(M,"EffectEmmiter");var N=class{constructor(e,r,s){I(e,"signal"),this.comp=e,this.opts={...this.constructor.defaults,...r},this.channels={},this.add(s),e.on("model:change",this.patch.bind(this))}patch(e,r,s,i,n,o,a){this.channels[s]&&this.channels[s].forEach(l=>l[0].set(l[1],o))}add(e,r){if(Array.isArray(e))e.forEach(s=>this.add(s[0],s[1]));else{e?.isComp||(e=$comp.getById(e));for(let s in r)this.channels[s]?this.channels[s].push([e,r[s]]):this.channels[s]=[[e,r[s]]],this.opts.fireOnAdd&&e.set(r[s],this.comp.get(s))}}remove(e,r){if(e?.isComp)if(r!==void 0)this.channels[r]?this.channels[r]=this.channels[r].filter(s=>s[0]!==e):this.comp.warn("signal: undefined property ("+r+")");else for(let s in this.channels)this.channels[s]&&(this.channels[s]=this.channels[s].filter(i=>i[0]!==e));else this.channels[e]||this.comp.warn("signal: undefined property ("+e+")"),this.channels[e]=void 0}};d(N,"Signal"),y(N,"defaults",{fireOnAdd:!0});var W=d((t,e,r,s,i)=>{var{el:n,mtype:o,stype:a,args:l}=e;if(o==="sub")t.view.appendSub(n,a,s,r,...l);else if(o==="comp"){var p=new($comp.get(a))(void 0,...l.slice(1));s===n.children.length?n.append(p.el):n.children[s].before(p.el),p.set(typeof r=="object"?r:l[0]||"value",r),t.addChild(p)}else if(o==="collection"){var p=new($comp.get(a))(void 0,...l.slice(1));s===n.children.length?n.append(p.el):n.children[s].before(p.el),p.set(typeof r=="object"?r:l[0]||"value",r),t.addChild(p),e.collection.add(p,s)}else throw new h("binder handler (for): undefined main type ("+o+")")},"handleCreate"),V=d((t,e,r,s)=>{var{mtype:i,el:n}=e;if(i==="sub")n.children[r].remove();else if(i==="comp")n.children[r].$comp.remove();else if(i==="collection")n.children[r].$comp.remove(),e.collection.remove(r);else throw new h("binder handler (for): undefined main type ("+i+")")},"handleDelete"),j=d((t,e,r,s,i)=>{var{mtype:n}=e;if(n==="sub")e.el.children[s].remove(),t.view.appendSub(e.el,e.stype,s,r,...e.args);else if(n==="comp")e.el.children[s].$comp.set(typeof r=="object"?r:e.args[0]||"value",r);else if(n==="collection")e.collection.setOne(r,s);else throw new h("binder handler (for): undefined main type ("+n+")")},"handleChange");var ee={attr(t,e,r){r.view.attr(t.el,t.attr,$comp.temps.parseAttr.handle(t.temp,r,t.el,void 0))},html(t,e,r){t.el.innerHTML=e},text(t,e,r){t.node.textContent=$comp.temps.parseAttr.handle(t.temp,r,t.el,void 0)},attrBasic(t,e,r){r.view.attr(t.el,t.attr,e)},attrCall(t,e,r){r.view.attr(t.el,t.attr,r.call(t.fun,e,...t.args))},if(t,e,r){r.call(t.fun,t.el,t.condF(r,t.el,...t.prop.map(s=>r.get(s))),...t.args)},ifElse(t,e,r){var s=t.prop.map(i=>r.get(i));t.conds.some(i=>i.condF(r,t.el,...s)&&(r.call(i.fun,t.el,!0,...i.args)||!0))},for(t,e,r,s,i,n,o){var{el:a,collection:l}=t;t.mtype==="collection"&&!t.collection&&(t.collection=new $comp.CompCollection([],t.args[0])),o.arr?o["arr:empty"]?(a.replaceChildren(...t.onemptyEls),t.mtype==="collection"&&l.remove(0,t.collection.comps.length)):o["arr:wasempty"]?(a.replaceChildren(),e.forEach((p,v)=>W(r,t,p,v,i))):(o["arr:patch"].forEach(p=>{if(p.type==="add"&&p.values.forEach((v,u)=>W(r,t,v,p.ind+u,i)),p.type==="delete")for(let v=p.count;v>0;v--)V(r,t,p.ind+v-1,i);p.type==="change"&&p.values.forEach((v,u)=>j(r,t,v,p.ind+u,i))}),t.type==="collection"&&l.set(e)):(a.replaceChildren(...t.onemptyEls),i&&(i.meta["arr:old"]=void 0))}};var te=d((t,e,r=3,s=5,i=n=>n)=>{if(!Array.isArray(t))throw new TypeError("dlff: old of type ("+t?.constructor?.type+") expected (Array)");if(!Array.isArray(e))throw new TypeError("dlff: new of type ("+e?.constructor?.type+") expected (Array)");for(var n=[],o=!1,a,l,p=e.length,v=t.length,u=0,A=0,g=0,x=0;u!==p&&A!==v;){if(g=0,o=!1,a=i(t[A]),l=i(e[u]),a===l){A++,u++;continue}for(;g!==r;){if(g++,A+g===v&&u+g===p){n.push({type:"change",ind:A+x,count:g,nind:u}),A=v,u=p,o=!0;break}if(A+g===v||u+g===p)break;if(i(t[A+g])===i(e[u+g])){n.push({type:"change",ind:A+x,count:g,nind:u}),A+=g,u+=g,o=!0;break}}if(!o){for(g=0;g!==s&&(g++,u+g!==p);)if(i(e[u+g])===a){n.push({type:"add",ind:A+x,count:g,nind:u}),u+=g,x+=g,o=!0;break}o||(n.push({type:"delete",ind:A+x,count:1}),x-=1,A++)}}return A!==v&&n.push({type:"delete",ind:A+x,count:v-A}),u!==p&&n.push({type:"add",ind:A+x,count:p-u,nind:u}),n},"simple");var re={Array(t,e,r,s,i){var n,o=e.meta["arr:old"];return i.set?n={...i,"arr:wasempty":!0}:(!o||o.length===0)&&s.length!==0?n={...i,"arr:wasempty":!0}:i["arr:op"]?n={...i,"arr:patch":[{...i,type:i["arr:op"]}]}:s.length===0?n={...i,"arr:empty":!0}:n={...i,"arr:patch":te(o,s).map(a=>({...a,values:s.slice(a.nind,a.nind+a.count)}))},e.meta["arr:old"]=[...s],n.arr=!0,n}};var P=class{constructor(e,r,s={},i={}){I(e,"binder"),this.comp=e,this.opts={...this.constructor.defaults,...r},this.handlers=ee,this.prehandlers=re,this.binds={},this.sets={};for(let n in s)s[n].forEach(o=>this.addBind(n,o));for(let n in i)i[n].forEach(o=>this.addSet(n,o));e.on("model:change",this.patch.bind(this)),this.opts.setOnInit&&e.on("init",()=>this.fireSet())}patch(e,r,s,i,n,o,a){this.binds[s]&&((a.prehandle===void 0&&this.opts.prehandle||a.prehandle)&&(a=this.prehandle(i,n,o,a)),this.binds[s].forEach(l=>this.handlers[l.type](l,o,this.comp,n,i,s,a)))}prehandle(e,r,s,i){return s?.constructor?.name in this.prehandlers?this.prehandlers[s?.constructor?.name](this.comp,e,r,s,i):i}addBind(e,r,s=!0,i=this.opts.prehandle){var n,o,a;if($(r.el,"binder"),!(r?.type in this.handlers))throw new h("binder: undefined bind type ("+r.type+")");if(Array.isArray(e)?e.forEach(l=>this.binds[l]?this.binds[l].push(r):this.binds[l]=[r]):this.binds[e]?this.binds[e].push(r):this.binds[e]=[r],!Array.isArray(e))var o=this.comp.model.get(e,!0),n=o.value;return s&&this.opts.setOnDefine&&(i&&(a=this.prehandle(e,n,n,{})),this.handlers[r.type](r,n,this.comp,n,o,e,{...a,set:!0})),this}addSet(e,r,s=!0,i=this.opts.prehandle){var n,o,a;if($(r.el,"binder"),!(r?.type in this.handlers))throw new h("binder: undefined bind type ("+r.type+")");if(Array.isArray(e)?e.forEach(l=>this.sets[l]?this.sets[l].push(r):this.sets[l]=[r]):this.sets[e]?this.sets[e].push(r):this.sets[e]=[r],!Array.isArray(e))var o=this.comp.model.get(e,!0),n=o.value;return s&&this.opts.setOnDefine&&(i&&(a=this.prehandle(e,n,n,{})),this.handlers[r.type](r,n,this.comp,n,o,e,{set:!0})),this}remove(e,r){if(e||(this.binds[r]=[],this.sets[r]=[]),$(e,"binder"),r!==void 0)this.binds[r]=this.binds[r].filter(s=>s.el!==e),this.sets[r]=this.sets[r].filter(s=>s.el!==e);else{for(let s in this.binds)this.binds[s]=this.binds[s].filter(i=>i.el!==e);for(let s in this.sets)this.sets[s]=this.sets[s].filter(i=>i.el!==e)}return this}fireSet(e,r={},s=this.opts.prehandle){if(e===void 0){for(let o in this.sets)this.fireSet(o,r,s);return}var i=this.comp.model.get(i,!0),n=i?.value;return e in this.sets?(s&&(r=this.prehandle(i,n,n,r)),this.sets[e].forEach(o=>this.handlers[o.type](o,n,this.comp,void 0,i,e,{...r,set:!0,reset:!0}))):this.comp.warn("binder: undefined property ("+e+")"),this}clean(){for(let e in this.binds)this.binds[e]=this.binds[e].filter(r=>document.contains(r.el));for(let e in this.sets)this.sets[e]=this.sets[e].filter(r=>document.contains(r.el));return this}};d(P,"Binder"),y(P,"defaults",{setOnDefine:!0,setOnInit:!0,prehandle:!0});var b=class{class=this.constructor;constructor(e,r,s=[]){r=this.opts={...this.class.defaults,...r},this.id=e?.nodeType===1&&e.hasAttribute("id")?e.getAttribute("id"):typeof r.id=="function"?r.id():r.id,this.parent=null,$comp.addById(this,this.id),this.acts=r.acts,this.funs=this.class.funs,this.events=new this.class.events({},r.addUndefEvent,r.warn),r.eventNames.forEach(i=>this.events.add(i));for(let i in r.events)r.events[i].forEach(n=>this.events.on(i,n));this.onEventsInit(),this.model=new this.class.model(this,r.model,r.data),this.view=new this.class.view(this,r.view,e),this.binder=new this.class.binder(this,r.binder,r.binds,r.sets),this.effects=new this.class.effects(this,r.effect),this.signal=new this.class.signal(this,r.signal,r.sChannels),this.children=[],O(s,"children"),s.forEach(i=>this.addChild(i)),this.on("appended-to-parent",(i,n)=>this.parent=n&&n.trigger("init:child",this)),this.on("deleted-child",(i,n)=>this.children=this.children.filter(o=>o!==n)),this.waitingNb||this.init()}isComp=!0;isDataProvider=!0;isInited=!1;internal_waitingNb=0;get waitingNb(){return this.internal_waitingNb}set waitingNb(e){this.internal_waitingNb=e,e===0&&this.init()}init(){this.opts.walkChilds&&this.walk(),this.isInited=!0,this.trigger("init"),this.callSafe("init")}addChild(e){var r;return e?.isComp?r=e:e?.isCompClass?r=new e:e?.isopts?r=new($comp.get(e.type))(e.el,e.opts,e.children):E(e,"comp","adding child"),this.children.push(r),this.trigger("appended-child",e),r.trigger("appended-to-parent",this),this}onEventsInit(){}remove(){this.trigger("deleted"),this.parent&&this.parent.trigger("deleted-child",this),$comp.root===this&&$comp.events.trigger("delete-root",this)&&($comp.root=null),this.el.remove(),$comp.idmap[this.id]=void 0}warn(e){this.opts.warn&&console[this.opts.warn](e)}addEvent(e){return this.events.add(e),this}on(e,r){return this.events.on(e,r),this}off(e,r){return this.events.off(e,r),this}once(e,r){return this.events.once(e,r),this}hasEvent(e){return this.events.has(e)}trigger(e,...r){return this.events.trigger(e,this,...r),this}addAct(e){if(!e)throw new h("comp: undefined action");return this.acts.push(e),this}doAct(e){if(!e)throw new h("comp: undefined action");return this.opts.doAct?e.el?$comp.acts.do(this,{...e,el:this.view.$(e.el)}):$comp.acts.do(this,e):this.addAct(e),this}doAllActs(){this.acts.forEach(e=>$comp.doAct(this,e))}call(e,...r){c(e,"name");var s=e.split(":");if(s.length===1){if(!(s[0]in this.funs))throw new h("comp: undefined function ("+s[0]+")");return this.funs[s[0]](this,...r)}return $comp.funNS[s[0]](s[1],this,!1,...r)}callSafe(e,...r){var s=e.split(":");return s.length===1?s[0]in this.funs?this.funs[s[0]](this,...r):void 0:$comp.funNS[s[0]](s[1],this,!0,...r)}addProp(e,r,s=!1){var i=this.model.add(e,r,!0);return s?i:this}set(e,r,s=!1){var i=this.model.set(e,r,!0);return s?i:this}get(e){return this.model.get(e)}deleteProp(e){return this.model.delete(e),this}has(e){return this.model.has(e)}addEffect(e,r){return this.effects.add(e,r),this}addSignal(e,r){return this.signal.add(e,r),this}walk(e,r=[]){return e?this.view.$(e).forEach(s=>this.view.walk(s,r)):[...this.el.children].forEach(s=>this.view.walk(s,r)),this}addRef(e,r){return this.view.addRef(e,r),this}};d(b,"Comp"),y(b,"defaults",{id(){return Math.round(Math.random()*$comp.opts.maxCompRandId)},warn:"warn",addUndefEvent:!0,eventNames:["appended-to-parent","appended-child","deleted","deleted-child","init","init:model","init:view","init:child","model:add","model:delete","model:change","render","collection:added"],events:{},get acts(){return[]},doAct:!0,model:{},data:{},get view(){return{subs:{}}},effects:{},signal:{},binder:{},binds:{},sets:{},sChannels:[],walkChilds:!0}),y(b,"events",F),y(b,"model",C),y(b,"view",S),y(b,"binder",P),y(b,"effects",M),y(b,"signal",N),y(b,"funs",{}),y(b,"isCompClass",!0);var se={propagAttrs:{"comp:log"(t,e,r){t.doAct({type:"comp:log",el:e,data:r})},"comp:logo"(t,e,r){t.doAct({type:"comp:log",el:e,data:r}),e.removeAttribute("comp:logo")},"comp:ref"(t,e,r){t.doAct({type:"comp:ref",el:e,name:r}),e.removeAttribute("comp:ref")},"comp:call"(t,e,r){JSON.parse(r).forEach(s=>t.doAct({type:"comp:call",el:e,fun:s[0],args:s.slice(1)})),e.removeAttribute("comp:call")}},unpropagAttrs:{"comp:this"(t,e,r){t.doAct({type:"comp:this",el:e,name:r}),e.removeAttribute("comp:this")},"comp:sub"(t,e,r){t.doAct({type:"comp:sub",el:e,data:JSON.parse(r)}),e.removeAttribute("comp:sub")},"comp:temp"(t,e){e.removeAttribute("comp:temp"),t.doAct({type:"comp:temp",el:e})}}};var ie={handle(t,e,r){return r.forEach(s=>{if(s.startsWith("bind(")){var i,n=s.indexOf(")"),o=s.slice(s.indexOf("(")+1,n).split(","),a=s.slice(n+2);if(a.includes(":")&&([a,i]=a.split(":")),!this.methods[a])throw new CompError("bind:attrs: undefined method ("+a+")");this.methods[a](t,e,e.getAttribute(s),o,s,i?i.replaceAll(/--./g,l=>l[2].toUpperCase()):void 0)}}),!0},methods:{attr(t,e,r,s,i){r.startsWith("[")?JSON.parse(r).forEach(n=>t.doAct({type:"bind:attr",el:e,prop:s,attr:n})):t.doAct({type:"bind:attr",el:e,prop:s,attr:r}),e.removeAttribute(i)},"attr-temp"(t,e,r,s,i,n){t.doAct({type:"bind:attr-temp",attr:n,prop:s,el:e,temp:r}),e.removeAttribute(i)},"attr-call"(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"bind:attr-call",el:e,prop:s,attr:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},text(t,e,r,s,i){t.doAct({type:"bind:text",el:e,prop:s}),e.removeAttribute(i)},html(t,e,r,s,i){t.doAct({type:"bind:html",el:e,prop:s}),e.removeAttribute(i)},if(t,e,r,s,i){var n=JSON.parse(r);t.doAct({type:"bind:if",el:e,prop:s,condF:Function("comp","el",s.map(o=>o.replace(/\..*/,"")),n[0].includes(";")?n[0]:"return "+n[0]),fun:n[1],args:n.slice(2)}),e.removeAttribute(i)},"if-else"(t,e,r,s,i){var n=JSON.parse(r),o=s.map(a=>a.replace(/\..*/,""));t.doAct({type:"bind:if-else",el:e,prop:s,conds:n.map(a=>({condF:Function("comp","el",...o,a[0].includes(";")?a[0]:"return "+a[0]),fun:a[1],args:a.slice(2)}))}),e.removeAttribute(i)},for(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"bind:for",el:e,prop:s,mtype:n,stype:o[0],args:o.slice(1),onemptyEls:[...e.childNodes]}),e.removeAttribute(i)}}};var ne={handle(t,e,r){return r.forEach(s=>{if(s.startsWith("set(")){var i,n=s.indexOf(")"),o=s.slice(s.indexOf("(")+1,n).split(","),a=s.slice(n+2);if(a.includes(":")&&([a,i]=a.split(":")),!this.methods[a])throw new CompError("set:attrs: undefined method ("+a+")");this.methods[a](t,e,e.getAttribute(s),o,s,i?i.replaceAll(/--./g,l=>l[2].toUpperCase()):void 0)}}),!0},methods:{attr(t,e,r,s,i){JSON.parse(r).forEach(n=>t.doAct({type:"set:attr",el:e,prop:s,attr:n})),e.removeAttribute(i)},"attr-temp"(t,e,r,s,i,n){t.doAct({type:"set:attr-temp",attr:n,prop:s,el:e,temp:r}),e.removeAttribute(i)},"attr-call"(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"set:attr-call",el:e,prop:s,attr:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},text(t,e,r,s,i){t.doAct({type:"set:text",el:e,prop:s}),e.removeAttribute(i)},html(t,e,r,s,i){t.doAct({type:"set:html",el:e,prop:s}),e.removeAttribute(i)},if(t,e,r,s,i){var n=JSON.parse(r);t.doAct({type:"set:if",el:e,prop:s,condF:Function("comp","el",s.map(o=>o.replace(/\..*/,"")),n[0].includes(";")?n[0]:"return "+n[0]),fun:n[1],args:n.slice(2)}),e.removeAttribute(i)},"if-else"(t,e,r,s,i){var n=JSON.parse(r),o=s.map(a=>a.replace(/\..*/,""));t.doAct({type:"set:if-else",el:e,prop:s,conds:n.map(a=>({condF:Function("comp","el",...o,a[0].includes(";")?a[0]:"return "+a[0]),fun:a[1],args:a.slice(2)}))}),e.removeAttribute(i)},for(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"set:for",el:e,prop:s,mtype:n,stype:o[0],args:o.slice(1),onemptyEls:[...e.childNodes]}),e.removeAttribute(i)}}};var oe={handle(t,e,r){return r.forEach(s=>{if(s.startsWith("on(")){var i,n=s.indexOf(")"),o=s.indexOf(":"),a=s.slice(s.indexOf("(")+1,n).split(","),l=s.slice(n+1,o).split("."),p=s.slice(o+1);if(p.includes(":")&&([p,i]=p.split(":")),!this.methods[p])throw new CompError("on:attrs: undefined method ("+p+")");this.methods[p](t,e,e.getAttribute(s),a,s,l,i?i.replace(/--./,v=>v[2].toUpperCase()):void 0)}}),!0},methods:{call(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"on:call",el:e,events:s,modifs:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},set(t,e,r,s,i,n){var o=JSON.parse(r);t.doAct({type:"on:set",el:e,events:s,modifs:n,prop:o[0],value:o[1]}),e.removeAttribute(i)},"set-fun"(t,e,r,s,i,n,o){var a=JSON.parse(r);t.doAct({type:"on:set-fun",el:e,events:s,modifs:n,prop:a[0],fun:o,args:a.slice(1)}),e.removeAttribute(i)},"set-attr"(t,e,r,s,i,n,o){t.doAct({type:"on:set-attr",el:e,events:s,modifs:n,prop:r,attr:o}),e.removeAttribute(i)},"set-attr-fun"(t,e,r,s,i,n,o){var a=JSON.parse(r);t.doAct({type:"on:set-attr-fun",el:e,events:s,modifs:n,prop:a[0],attr:a[1],fun:o,args:a.slice(2)}),e.removeAttribute(i)}}};var ae={handlers:{"use:comp":se,"use:bind":ie,"use:set":ne,"use:on":oe},curEl:null,curAttr:null,add(t,e){c(t,"name","attrs"),this.handlers[t]=e},walk(t,e,r=[]){if(E(t,"attrs"),$(e,"attrs"),O(r,"forceNS","attrs"),!e.hasAttribute("is:static")){this.curEl=e;var s=e.getAttributeNames(),i=!0;r.concat(s.filter(n=>n.startsWith("use")&&!r.includes(n))).forEach(n=>{let o=this.handlers[n];if(o.handle)return i=o.handle(t,e,s)||i;s.forEach(a=>{this.curAttr=a,a in o.propagAttrs&&o.propagAttrs[a](t,e,e.getAttribute(a)),a in o.unpropagAttrs&&(o.unpropagAttrs[a](t,e,e.getAttribute(a)),i=!1)})}),i&&[...e.children].forEach(n=>n.$comp?n.$comp.walk():this.walk(t,n))}},clean(t){$(t,"attrs"),t.getAttributeNames().forEach(e=>{e.startsWith("use")&&t.removeAttribute(e)}),[...t.children].forEach(e=>this.clean(e))}};var de={"comp:this"(t,e){var{el:r,name:s}=e;r.forEach(i=>{let n=new($comp.get(s))(i);t.addChild(n)})},"comp:log"(t,e){console.log([e.data||"hallo",e?.el?.[0],t])},"comp:sub"(t,e){t.view.setSub(e.el,...e.data)},"comp:ref"(t,e){t.view.addRef(e.name,e.el)},"comp:call"(t,e){t.call(e.fun,e.el[0],...e.args)},"comp:temp"(t,e){[...e.el[0].children].forEach(r=>t.walk(r,["use:bind","use:set","use:on"]))}};var he={"bind:attr"(t,e){t.binder.addBind(e.prop,{type:"attrBasic",el:e.el[0],attr:e.attr})},"bind:attr-temp"(t,e){t.binder.addBind(e.prop,{type:"attr",el:e.el[0],attr:e.attr,temp:$comp.temps.parseAttr(e.temp,t,e.el[0])})},"bind:attr-call"(t,e){t.binder.addBind(e.prop,{type:"attrCall",el:e.el[0],attr:e.attr,fun:e.fun,args:e.args})},"bind:text"(t,e){var r=e.el[0];r.childNodes.forEach(s=>{if(s.nodeType===s.TEXT_NODE){var i=$comp.temps.parseAttr(s.textContent,t,r);t.binder.addBind(e.prop,{type:"text",el:r,node:s,temp:i})}})},"bind:html"(t,e){t.binder.addBind(e.prop,{type:"html",el:e.el[0]})},"bind:if"(t,e){t.binder.addBind(e.prop,{type:"if",el:e.el[0],prop:e.prop,condF:e.condF,fun:e.fun,args:e.args})},"bind:if-else"(t,e){t.binder.addBind(e.prop,{type:"ifElse",el:e.el[0],prop:e.prop,conds:e.conds})},"bind:for"(t,e){t.binder.addBind(e.prop,{type:"for",el:e.el[0],mtype:e.mtype,stype:e.stype,args:e.args,onemptyEls:e.onemptyEls})}};var pe={"set:attr"(t,e){t.binder.addSet(e.prop,{type:"attrBasic",el:e.el[0],attr:e.attr})},"set:attr-temp"(t,e){t.binder.addSet(e.prop,{type:"attr",el:e.el[0],attr:e.attr,temp:$comp.temps.parseAttr(e.temp,t,e.el[0])})},"set:attr-call"(t,e){t.binder.addSet(e.prop,{type:"attrCall",el:e.el[0],attr:e.attr,fun:e.fun,args:e.args})},"set:text"(t,e){var r=e.el[0];r.childNodes.forEach(s=>{if(s.nodeType===s.TEXT_NODE){var i=$comp.temps.parseAttr(s.textContent,t,r);t.binder.addSet(e.prop,{type:"text",el:r,node:s,temp:i})}})},"set:html"(t,e){t.binder.addSet(e.prop,{type:"html",el:e.el[0]})},"set:if"(t,e){t.binder.addSet(e.prop,{type:"if",el:e.el[0],prop:e.prop,condF:e.condF,fun:e.fun,args:e.args})},"set:if-else"(t,e){t.binder.addSet(e.prop,{type:"ifElse",el:e.el[0],prop:e.prop,conds:e.conds})},"set:for"(t,e){t.binder.addSet(e.prop,{type:"for",el:e.el[0],mtype:e.mtype,stype:e.stype,args:e.args,onemptyEls:e.onemptyEls})}};var D=d((t,e,r,s=[],i=[],...n)=>{E(t,"listen"),$(e,"listen"),w(r,"fn","listen"),O(s,"events","listen"),s.length===0&&t.warn("listen: no specified events"),O(i,"modifiers","listen");var o=i.includes("preventdefaults"),a=i.includes("once"),l=i.includes("capture"),p=i.includes("passive"),v=i.includes("stoppropagation"),u=i.includes("self"),A=i.includes("trusted"),g=d(x=>{A&&!x.isTrusted||u&&x.target!==e||(o&&x.preventDefault(),v&&x.stopPropagation(),r(t,e,x,...n))},"fn");return s.forEach(x=>e.addEventListener(x,g,{once:a,capture:l,passive:p})),g},"handleListen");var le={"on:call"(t,e){var{el:r,fun:s,args:i}=e;r=r[0],D(t,r,n=>t.call(s,r,...i),e.events,e.modifs)},"on:set"(t,e){var{prop:r,value:s}=e;D(t,e.el[0],i=>t.set(r,s),e.events,e.modifs)},"on:set-fun"(t,e){var{prop:r,fun:s,value:i,args:n}=e;D(t,e.el[0],o=>t.model.setFn(r,s,!0,...n),e.events,e.modifs)},"on:set-attr"(t,e){var{prop:r,attr:s,el:i}=e;i=i[0],D(t,i,n=>t.set(r,t.view.attr(i,s)),e.events,e.modifs)},"on:set-attr-fun"(t,e){var{prop:r,attr:s,el:i,fun:n,args:o}=e;i=i[0],D(t,i,a=>t.model.setFn(r,n,!1,t.view.attr(i,s),...o),e.events,e.modifs)}};var ce={actions:{...de,...he,...pe,...le},add(t,e){c(t,"type","action"),w(e,"action","action"),this.actions[t]=e},do(t,e){if(E(t),!e?.type||!(e.type in this.actions))throw new h("action: undefined action type ("+e?.type+")");this.actions[e.type](t,e)}};var fe={mg(t,e,r,s,...i){if(!(r&&t in e.model.funs))return e.model.getFn(s,t,...i)},m(t,e,r,...s){var i=e.model.funs[t];if(i)return i(e.model,...s);if(r)return;throw new h("model: undefined function ("+t+")")},v(t,e,r,s,...i){if(!(r&&t in e.view.funs))return e.view.call(s,t,...i)}};var k=d((t,e,r,s)=>{c(t,"str","parse attr");var i=t.split(k.regex),n=[];return i.forEach(o=>{if(o!=="")if(o.startsWith("{")){if(o.startsWith("{{#"))return n.push({type:"val",value:Function("comp","model","el","value",o.includes(";")?o.slice(3,-2):"return "+o.slice(3,-2))(e,e.model,r,s)});if(o.startsWith("{{"))return n.push({type:"exp",fun:Function("comp","model","el","value",o.includes(";")?o.slice(2,-2):"return "+o.slice(2,-2))});if(o.startsWith("{$"))return n.push(Ee(o.slice(2,-1)));if(o.startsWith("{@"))return n.push({type:"vNS",value:o.slice(2,-1).split(":")});n.push({type:"prop",name:o.slice(1,-1)})}else n.push({type:"val",value:o})}),n},"parse");k.regex=/({{[\s\S]+?}}|{[^{]+})/;k.parseArg=t=>{if(t[0]==="@")return t.slice(1).split(":");if(t==="true")return!0;if(t==="false")return!1;if(t==="null")return null;if(t!=="undefined"){var e=Number(t);return isNaN(e)?t:e}};var xe=d(t=>t.split(",").map(e=>e.trim()).map(k.parseArg),"parseArgs"),Ee=d(t=>{var e=t.trim().split("(");return{type:"call",fun:e[0].trim(),args:xe(e[1].trimEnd().slice(0,-1))}},"parseFun");k.valueNS={attr(t,e,r,s){return t.view.attr(e,s[1])},prop(t,e,r,s){return t.get(s[1])}};k.handle=(t,e,r,s)=>{if(E(e,"parse attr"),$(r,"parse attr"),typeof t=="string")var i=k(t,e,r,s);else if(Array.isArray(t))var i=t;else throw new h("parse attr: str of type ("+t?.constructor?.name+"), expected (String) or (Array)");return i.map(n=>{if(n.type==="val")return n.value;if(n.type==="prop")return e.get(n.name);if(n.type==="exp")return n.fun(e,e.model,r,s);if(n.type==="call")return e.call(obj.fun,...obj.args.map(o=>Array.isArray(o)?k.valueNS[o[0]](e,r,s,o):o));if(n.type==="vNS")return k.valueNS[n.value[0]](e,r,s,n.value);throw new h("parse attr: undefined attribute expression type ("+n.type+")")}).join("")};var ue={temps:{},subs:{},add(t,e){c(t,"name","temps"),t in this.temps&&$comp.warn("comp: adding defined template ("+t+")");var r;typeof e=="string"?(r=L(e),this.temps[t]=()=>({els:r.map(s=>s.cloneNode(!0)),acts:[]})):e?.nodeType===1?this.temps[t]=()=>({els:Array.from(e.cloneNode(!0).childNodes),acts:[]}):(w(e,"temp","temps"),this.temps[t]=e),$comp.events.trigger("temp-added",t,this.temps[t])},has(t){return c(t,"name","temps"),t in this.temps},get(t){if(c(t,"name","temps"),!(t in this.temps))throw new h("comp: undefined template ("+t+")");return this.temps[t]},getLazy(t,e){c(e,"name","temps");var r=d(s=>{s===e&&($comp.events.off("temp-added",r),t.render(),t.comp.waitingNb-=1)},"fn");this.temps[e]?r(e):$comp.events.on("temp-added",r)},addSub(t,e){c(t,"name","temps"),t in this.subs&&$comp.warn("comp: adding defined sub ("+t+")");var r;if(typeof e=="string"){let s=L(e)[0];this.subs[t]={$isSub:!0,fn(){return{el:s.cloneNode(!0),acts:[]}}}}else e?.nodeType===1?this.subs[t]={$isSub:!0,fn(){return{el:e.cloneNode(!0),acts:[]}}}:(w(e?.fn,"fn","temps"),this.subs[t]=e)},hasSub(t){return c(t,"name","temps"),t in this.subs},getSub(t){if(c(t,"name","temps"),!(t in this.subs))throw new h("comp: undefined sub ("+t+")");return this.subs[t]},parseAttr:k,listen:D};var me=d((t,e)=>{throw new h("collection: index ("+t+") greater than length ("+e+")")},"throwIndGT"),J=class{constructor(e=[],r="value"){O(e,"comps"),this.comps=e,this.propName=r,e.forEach(s=>s.trigger("collection:added",this))}add(e,r){return R(r,"index","collection"),r>this.comps.length&&me(r,this.comps.length),this.comps.splice(r,0,e),e.trigger("collection:added",this),this}get(e){return this.comps[e]}get length(){return this.comps.length}set(e){return Array.isArray(e)?(e.length!==this.comps.length&&$comp.warn("collection: values length ("+e.length+") is not equal to length ("+this.comps.length+")"),e.forEach((r,s)=>this.comps[s]&&this.comps[s].set(typeof r=="object"?r:this.propName,r))):$comp.warn("collection: values of type ("+e?.constructor?.name+"), expected (Array)"),this}setOne(e,r){return R(r,"index","collection"),this.comps.length<=r?$comp.warn("collection: index ("+r+") greater than length ("+this.comps.length+")"):this.comps[r].set(typeof e=="object"?e:this.propName,e),this}remove(e,r=1){R(e,"index","collection"),e>=this.comps.length&&me(e,this.comps.length),this.comps.splice(e,r)}};d(J,"CompCollection");var m={currentComp:null,compStack:[],push(t){E(t,"functional"),this.compStack.push(t),this.currentComp=t},pop(){this.compStack.pop(),this.currentComp=this.compStack.length===0?null:this.compStack[this.compStack.length-1]},getCur(t=!0){if(this.currentComp)return this.currentComp;if(t)throw new h("functional: component stack length is 0")},enableFor(t){return w(t,"fn","functional"),(e,...r)=>{this.push(e),t(...r),this.pop()}},currentClass:null,createComp(t,e=Comp){w(t,"createFn","functional"),z(e,"superClass","functional");var r=d(class extends e{static defaults={...e.defaults}},"FComp");this.currentClass=r;var s=t();return r.defaults.view.temp=s,this.currentClass=null,r},useClass(){if(!this.currentClass)throw new h("functional: currentClass is not defined");return this.currentClass},useDefaults(){return this.useClass().defaults},setFun(t,e){this.useClass().funs[t]=this.enableFor(e)},setSub(t,e){this.useClass().defaults.view.subs[t]=e},useComp(){return this.getCur()},useStore(){return this.getCur().model.toProxy()},useState(t,e){var r=this.getCur();e!==void 0&&!r.has(t)&&r.set(t,e);var s=r.model.get(t,!0),i=s.value;return[i,n=>r.set(t,n),()=>r.get(t),s]},useEffect(t,e){this.getCur().addEffect(t,typeof e=="string"?e:this.enableFor(e))},useSignal(t,e){this.getCur().addSignal(t,e)},useEvent(t,e){this.getCur().on(t,this.enableFor(e))},useTrigger(t,...e){this.getCur().trigger(t,...e)},useCall(t,...e){return this.getCur().call(t,...e)},useCallSafe(t,...e){return this.getCur().callSafe(t,...e)},useRef(t){return this.getCur().refs[t]},use$(...t){return this.getCur().view.$(...t)},useSub(t,...e){return this.useComp().view.createSub(t,...e)},useEl(){return this.getCur().el},useAttr(t,e,r){return this.getCur().view.attr(t,e,r)}};for(let t in m)typeof m[t]=="function"&&(m[t]=m[t].bind(m));var T=class{isComp=!0;constructor(e,...r){this.name=e,this.args=r,r[0]?.hasAttribute?.("is-root")&&(this.isRoot=!0),this.fn=this.handle.bind(this),$comp.events.on("comp-added",this.fn)}trigger(e,...r){if(e==="appended-to-parent")this.parent=r[0];else if(e==="deleted-child")$comp.events.off("comp-added",this.fn);else throw new CompError("lazy comp: undefined event ("+e+")")}handle(e,r){if(e===this.name){if($comp.events.off("comp-added",this.fn),this.isRoot)return $comp.setRoot(this.args[0],e,this.args.slice(1));if(!this.parent)throw new CompError("lazy comp: undefined parent");var s=new r(...this.args);this.parent.children[this.parent.children.indexOf(this)]=s,s.trigger("appended-to-parent",this.parent)}}};d(T,"LazyComp"),y(T,"isCompClass",!0);var ve={add(){throw new CompError("lazy comp manager: unsupported method (add)")},has(){throw new CompError("lazy comp manager: unsupported method (has)")},get(t){return $comp.has(t)?$comp.get(t):$e(t)}},$e=d(t=>new Proxy(T,{get(e,r){return e[r]},construct(e,r){return new e(t,...r)}}),"createProxy");var f={isDataProvider:!0,opts:{warn:"warn",maxCompRandId:2**30},warn(t){this.opts.warn&&console[this.opts.warn](t)},comps:{basic:b},compMans:{lazy:ve},add(t,e){z(e,"adding class"),c(t,"name");var r=t.split(":");if(r.length!==1){if(!this.compMans[r[0]])throw new h("comp: undefined component manager ("+r[0]+")");return this.compMans[r[0]].add(r[1])}t in this.comps&&this.warn("comp: adding defined component ("+t+")"),this.comps[t]=e,this.events.trigger("comp-added",t,e)},get(t){if(t?.isCompClass)return t;if(t?.isComp)return t.class;c(t,"name");var e=t.split(":");if(e.length!==1){if(!this.compMans[e[0]])throw new h("comp: undefined component manager ("+e[0]+")");return this.compMans[e[0]].get(e[1])}var r=this.comps[t];if(r)return r;throw new h("comp: undefined comp ("+t+")")},has(t){c(t,"name");var e=t.split(":");return e.length===1?t in this.comps:this.compMans[e[0]].has(e[1])},root:null,setRoot(t,e="basic",...r){return $(t),this.root=e.isComp?e:new(this.get(e))(t,...r),this.events.trigger("set-root",this.root),this.root},idmap:{},addById(t,e){return E(t),this.idmap[e]?this.warn("comp: defined id ("+e+")"):(this.idmap[e]=t,this.events.trigger("id-added")),this},getById(t,e=!0){var r=this.idmap[t];if(!r&&e)throw new h("comp: undefined component of id ("+t+")");return r},events:new F,on(t,e){return this.events.on(t,e),this},off(t,e){return this.events.off(t,e),this},trigger(t,...e){return this.events.trigger(t,this,...e),this},acts:ce,doAct(t,e){this.acts.do(t,e)},attrs:ae,walk(t,e){this.attrs.walk(t,e)},funNS:fe,func:m,temps:ue,addProp(t,e,r){var s=this.model.add(t,e,!0);return r?s:this},setProp(t,e,r=!1){var s=this.model.set(t,e,!0);return r?s:this},getProp(t,e=!1){return this.model.get(t,e)},deleteProp(t){return this.model.delete(t),this},hasProp(t){return this.model.has(t)},addEffect(t,e){return this.effect.add(t,e),this},addSignal(t,e){return this.signal.add(t,e),this},classes:{comp:b,event:F,error:h,model:C,view:S,binder:P,effect:M,signal:N,collection:J,lazyComp:T},Comp:b,EventEmmiter:F,CompError:h,Model:C,View:S,CompCollection:J,Binder:P,EffectEmmiter:M,Signal:N,LazyComp:T};for(let t in f)f[t]?.bind&&!f[t].prototype&&(f[t]=f[t].bind(f));globalThis.$comp=f;globalThis.CompError=h;globalThis.Comp=b;["comp-added","set-root","delete-root","id-added","temp-added","model:add","model:delete","model:change","init:model"].forEach(t=>f.events.add(t));Object.assign(f,{model:new C(f,{},{}),signal:new N(f,{},[]),effect:new M(f,{})});b.defaults.warn=f.opts.warn;var Rr=f,Jr=f.get,Lr=f.add,zr=f.has,Hr=f.setRoot,Wr=f.getById,_r=f.addById,Ur=f.on,qr=f.off,Kr=f.once,Gr=f.trigger,Xr=f.doAct,Qr=f.walk,Yr=f.addProp,Zr=f.setProp,Vr=f.getProp,jr=f.hasProp,es=f.deleteProp,ts=f.addEffect,rs=f.addSignal,ss=m.createComp,is=m.enableFor,ns=m.useClass,os=m.useDefaults,as=m.setFun,ds=m.useComp,hs=m.useStore,ps=m.useState,ls=m.useEffect,cs=m.useEvent,fs=m.useTrigger,us=m.useSignal,ms=m.useCall,vs=m.useCallSafe,gs=m.useRef,ys=m.use$,ws=m.useEl,As=m.useAttr;export{f as $comp,b as Comp,h as CompError,M as EffectEmmiter,F as EventEmmiter,C as Model,N as Signal,S as View,Lr as add,_r as addById,ts as addEffect,Yr as addProp,rs as addSignal,ss as createComp,Rr as default,es as deleteProp,Xr as doAct,is as enableFor,Jr as get,Wr as getById,Vr as getProp,zr as has,jr as hasProp,qr as off,Ur as on,Kr as once,as as setFun,Zr as setProp,Hr as setRoot,Gr as trigger,ys as use$,As as useAttr,ms as useCall,vs as useCallSafe,ns as useClass,ds as useComp,os as useDefaults,ls as useEffect,ws as useEl,cs as useEvent,gs as useRef,us as useSignal,ps as useState,hs as useStore,fs as useTrigger,Qr as walk};
