var U=Object.defineProperty;var ce=(r,e,t)=>e in r?U(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var p=(r,e)=>U(r,"name",{value:e,configurable:!0});var y=(r,e,t)=>(ce(r,typeof e!="symbol"?e+"":e,t),t);var l=class extends Error{constructor(e="comp: empty"){var t=e.indexOf(":");super(e.slice(t+1).trim()),this.name=e.slice(0,t)}};p(l,"CompError");var w=p((r,e,t="comp")=>{if(typeof r!="function")throw new l(`${t}: ${e} of type (${r?.constructor?.name}), expected (Function)`)},"checkfn"),f=p((r,e,t="comp")=>{if(typeof r!="string")throw new l(`${t}: ${e} of type (${r?.constructor?.name}), expected (String)`)},"checkstr"),C=p((r,e,t="comp")=>{if(!Array.isArray(r))throw new l(`${t}: ${e} of type (${r?.constructor?.name}), expected (Array)`)},"checkarr"),J=p((r,e,t,s=0)=>{if(typeof r!="number")throw new l(`${t}: ${e} of type (${r?.constructor?.name}), expected (Number)`);if(!Number.isInteger(r)||r<s)throw new l(`${t}: ${e} is (${r}), expected positive integer`)},"checkpInt"),$=p((r,e="comp",t="el")=>{if(r?.nodeType!==1)throw new l(`${e}: ${t} of type (${r?.constructor?.type}), expected (Element)`)},"checkel"),E=p((r,e="comp",t="component")=>{if(!r?.isComp)throw new l(`${e}: ${t} of type (${r?.constructor?.name}), expected (@component)`)},"checkcomp"),z=p((r,e="component",t="comp")=>{if(!r?.isCompClass)throw new l(`${t}: ${e} of type (${r?.name||r?.constructor?.name}), expected (@component)`)},"checkCompClass"),D=p((r,e)=>{if(!r?.isDataProvider)throw new l(`${e}: provider of type (${r?.constructor?.name}), expected (@DataProvider)`)},"checkDataProv");var P=class{constructor(e={},t=!0,s="warn"){this.events=e,this.warn=s,this.addUndef=t}add(e){return f(e,"name","event"),e in this.events&&this.warn&&console[this.warn]("event: adding defined event ("+e+")"),this.events[e]=[],this}has(e){return f(e,"name","event"),e in this.events}on(e,t){if(typeof e=="object"){for(let s in e)this.on(s,e[s]);return this}return f(e,"name","event"),w(t,"handler","event"),e in this.events?this.events[e].push(t):this.addUndef?this.events[e]=[t]:this.warn&&console[this.warn]("event: udefined event ("+e+")"),this}off(e,t){return f(e,"name","event"),w(t,"handler","event"),e in this.events?t?this.events[e].splice(this.events[e].indexOf(t),1):this.events[e]=[]:this.warn&&console[this.warn]("event: udefined event ("+e+")"),this}once(e,t){f(e,"name","event"),w(t,"handler","event");var s=p((...i)=>{t(...i),this.off(e,s)},"onceFn");return this.on(e,s)}trigger(e,...t){return f(e,"name","event"),e in this.events?this.events[e].forEach(s=>s(...t)):this.warn&&console[this.warn]("event: udefined event ("+e+")"),this}};p(P,"EventEmmiter");var B=p((r,e,t,s)=>r.comp.warn("model fn ("+t+"): "+s+" of type ("+e?.constructor?.name+"), expected (Array)"),"warnNotArray"),H=p((r,e,t,s)=>r.comp.warn("model fn ("+e+"): index ("+t+") greater than length ( "+s+" )"),"warnIndGT"),q={toStr(r,e){return String(e)},toJSON(r,e){return JSON.stringify(e)},toBase64(r,e){return btoa(e)},toNb(r,e){return Number(e)},toggle(r,e,t){if(Array.isArray(t)){t.length===0&&r.comp.warn("model fn (toggle): checklist is empty");var s=t.indexOf(e)+1;return t[s>t.length-1?0:s]}else return B(r,t,"toggle","checklist"),e},toggleBl(r,e){return!e},inc(r,e,t=1){var s=Number(e);return isNaN(s)?0:s+(t-0)},incMinMax(r,e,t=0,s=60,i=1){var n=Number(e);return isNaN(n)?t:Math.max(Math.min(n+i,s),t)},incCircular(r,e,t=0,s=60,i=1){var n=Number(e);if(isNaN(n))return t;var o=n+i,a=s-t;return(o-t)%a+(o<t?t+a:t)},random(r,e,t=0,s=100,i=!0){var n=Math.random()*(s-t)+t;return i?Math.round(n):n},min(r,e,t=0){var s=Number(e);return isNaN(s)?t:Math.min(s,t)},max(r,e,t=100){var s=Number(e);return isNaN(s)?t:Math.max(s,t)},minMax(r,e,t=0,s=100){var i=Number(e);return isNaN(i)?t:Math.max(t,Math.min(i,s))},circular(r,e,t=0,s=60){var i=Number(e);if(isNaN(i))return t;var n=s-t;return(i-t)%n+(i<t?t+n:t)},round(r,e){return Math.round(Number(e))},push(r,e,t){return e?.push?(e.push(t),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:e.length-1,values:[t]}}):(B(r,e,"push","property"),e)},pop(r,e){return e?.pop?e.length===0?e:(e.pop(),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:e.length}}):(B(r,e,"pop","property"),e)},unshift(r,e,t){return e?.unshift?(e.unshift(t),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:0,values:[t]}}):(B(r,e,"unshift","property"),e)},shift(r,e){return e?.shift?e.length===0?e:(e.shift(),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:0}}):(B(r,e,"shift","property"),e)},arrSet(r,e,t,s=0){return Array.isArray(e)?(e.length<=s&&H(r,"arrSet",s,e.length),e[s]=t,{$hasMeta:!0,value:e,meta:{"arr:op":"change",force:!0,ind:s,values:[t]}}):(B(r,e,"arrSet","property"),e)},arrIns(r,e,t,s=0){return Array.isArray(e)?(e.length<s&&H(r,"arrIns",s,e.length),e.splice(s,0,t),{$hasMeta:!0,value:e,meta:{"arr:op":"add",force:!0,ind:s,values:[t]}}):(B(r,e,"arrSet","property"),e)},arrDel(r,e,t=0){return Array.isArray(e)?(e.length<=t&&H(r,"arrDel",t,e.length),e.splice(t,1),{$hasMeta:!0,value:e,meta:{"arr:op":"delete",force:!0,ind:t}}):(B(r,e,"arrSet","property"),e)}};var me={set(r,e,t){r.set(e,t)},get(r,e){return r.get(e)},has(r,e){return r.has(e)},deleteProperty(r,e){return r.delete(e)},ownKeys(r){return r.getAllKeys()}},K=p(r=>new Proxy(r,me),"createProxy");var S=class{class=this.constructor;constructor(e,t={},s={}){D(e,"model"),this.comp=e,this.funs=this.class.funs,this.opts={...this.class.defaults,...t},w(this.opts.doPropagate,"doPropagate","model"),this.data={};for(let i in s)this.addLow(i,s[i]);this.deps={},this.init(),this.comp.trigger("init:model",this)}init(){}addLow(e,t){if(t?.$hasMeta)var s={...this.opts.propObj,...t,name:e};else var s={...this.opts.propObj,value:t,name:e};if(s.meta={...s.meta},s.init&&w(s.init,"initFn","model"),s.setter&&w(s.init,"setter","model"),s.getter&&w(s.init,"getter","model"),this.data[e])if(this.comp.warn("model: adding defined property ("+e+")"),this.opts.addDef)this.data[e]=s;else return;else this.data[e]=s;return s.init&&s.init(this.comp,this),this.comp.trigger("model:add",this,e,s),s}add(e,t,s=!1){var i=this.addLow(e,t);return i&&i.isReactive&&this.opts.propagate&&this.propagate(e,i),s?i:this}propagate(e,t=this.data[e],s,i=t.value,n={}){t?(n.force===!0||this.opts.doPropagate(s,i))&&(this.comp.trigger("model:change",this,e,t,s,i,n),n.propagDeps===!0&&this.deps[e]&&this.deps[e].forEach(o=>this.propagate(o,void 0,void 0,void 0,{propagDeps:!1,force:!0})),this.opts.propagParent&&i!==t.value&&this.propagate(t.name,t,void 0,void 0,{force:!0,sinceChild:!0})):this.comp.warn("model: propagating undefined property ("+e+")")}getLow(e,t=!1){var s=String(e).split("."),i=!1;if(s.length===0)return[];var n=this.data[s[0]];if(!n&&t===!1)return this.comp.warn("model: stoped at path ("+s[0]+")"),[void 0,void 0,void 0,s,void 0];!n&&t&&(n=this.addLow(s[0],{}),i=!0);var o=n.value,a;if(s.length===1)return[o,n,o,s,i];if(o==null)return this.comp.warn("model: stoped at path ("+s.join(".")+")"),[void 0,n,void 0,s,i];for(let d=0;d<s.length;d++)if(d!==0&&d!==s.length-1)if(a=s[d],o[a]!==void 0&&o[a]!==null)o=o[a];else if(t&&typeof o=="object")o[a]={},o=o[a];else return this.comp.warn("model: stoped at path ("+s.slice(0,d+1).join(".")+")"),[void 0,n,void 0,s,i];return[o[s[s.length-1]],n,o,s,i]}setLow(e,t){var i=this.data[e];if(i?.setter)return[i,...i.setter(t,o,comp),!0];var[s,i,n,o,a]=this.getLow(e,!0);if(o.length===1)i.value=t;else if(n)n[o[o.length-1]]=t;else return[i,void 0,void 0,!1];return[i,a?void 0:s,t,!0]}set(e,t,s=!1,i={}){if(typeof e=="object"){for(let h in e)this.set(h,e[h]);return this}var[n,o,a,d]=this.setLow(e,t);return d&&n.isReactive&&this.opts.propagate&&this.propagate(e,n,o,a,i),s?n:this}get(e,t=!1){var s=this.data[e];return t?s:s?.getter?s.getter(path,comp):this.getLow(e,!1)[0]}getFn(e,t,...s){var i=typeof t=="function"?t:this.funs[t];if(!i)throw new l("model: undefined function ("+t+")");var n=i(this,this.get(e),...s);return n?.$hasMeta?n.value:n}setFn(e,t,s=!0,...i){var n=typeof t=="function"?t:this.funs[t];if(!n)throw new l("model: undefined function ("+t+")");var o=s?n(this,this.get(e),...i):n(this,...i),a=o?.$hasMeta?o.value:o;return this.set(e,a,!1,o?.meta),this}has(e){return!!this.data[String(e).split(".")[0]]}delete(e){return this.data[e]===void 0?!1:(this.data[e]=void 0,this.comp.trigger("model:delete",this,e),!0)}getAllKeys(){return Object.keys(this.data).filter(e=>this.data[e]!==void 0)}addDep(e,t){return C(t,"dependencies","model"),Array.isArray(e)?e.forEach(s=>this.deps[s]?this.deps[s].push(...t):this.deps[s]=[...t]):this.deps[e]?this.deps[e].push(...t):this.deps[e]=[...t],this}toProxy(){return K(this)}toObj(){var e={};for(let t in this.data)e[t]=this.get(t);return e}toJSON(){return JSON.stringify(this.toObj())}};p(S,"Model"),y(S,"defaults",{addDef:!1,propObj:{$hasMeta:!0,meta:{},isReactive:!0,name:""},propagate:!0,doPropagate:(e,t)=>e!==t,propagParent:!1,propagDeps:!0}),y(S,"funs",q);var G={$subInd(r){for(var e=r.$subEl?r.$subEl:r;!e.$comp&&!e.$isSub;)e=e.parentElement;return e.$comp?-1:(r.$subEl=e,[...e.parentElement.children].indexOf(e))}};var X={show(r,e){r.forEach(t=>t.style.display=e?"":"none")}};function L(r,e=document){if(!r)return[];if(!e?.querySelectorAll)throw new TypeError("el: root element of type ("+e?.constructor?.name+"), expected (Element) or (Document)");if(typeof r=="string"){if(r.startsWith("<")){var t=L.tag("div");return t.innerHTML=r,Array.from(t.children)}return Array.from(e.querySelectorAll(r))}else return r instanceof HTMLElement?[r]:Array.isArray(r)?r:"length"in r?[...r]:L.obj(r)}p(L,"$el");Object.assign(L,{tag:document.createElement.bind(document),obj(r={}){if(typeof r=="string")return document.createTextNode(r);var{tag:e="div",text:t,classList:s,style:i,attr:n,event:o,children:a,...d}=r,h=L.tag(e);if(Array.isArray(s)?h.className=s.join(" "):typeof s=="string"&&(h.className=s),n)for(let c in n)h.setAttribute(c,n[c]);if(t&&(h.innerText=t),i&&Object.assign(h.style,i),o)for(let c in o)o[c].forEach(g=>h.addEventListener(c,g));return Object.assign(h,d),Array.isArray(a)&&a.forEach(c=>{h.append(L.obj(c))}),h}});globalThis.$el=L;var W=L;var N=class{class=this.constructor;constructor(e,t={},s){E(e,"view"),this.comp=e;var i=this.opts={...this.class.defaults,...t};f(i.tempAppendMode,"tempAppendMode","view"),s=s?.nodeType===1?s:this.$(i.el)[0],s.$comp=e,this.el=s,this.comp.el=s,this.attrs=this.class.attrs,this.funs=this.class.funs,this.subs=i.subs,this.subs={};for(let o in i.subs){let a=i.subs[o];this.subs[o]=a.$isSub?a:this.$(a)[0]}this.refs={};var n=i.refs;for(let o in n)this.refs[o]=this.$(n[o]);this.comp.refs=this.refs,i.lazyTemp?(this.comp.waitingNb++,$comp.temps.getLazy(this,i.temp)):this.render(),e.trigger("init:view",this)}$(e,t=this.el){return W(e,t)}render(){var e=this.opts.temp,t=this.el,s,i=[],n=this.opts.tempAppendMode;if(typeof e=="string"?e[0]==="<"?s=this.$(e):{els:s,acts:i=[]}=$comp.temps.get(e)(this):e.nodeType===1?s=e.cloneNode(!0).childNodes:{els:s="",acts:i=[]}=e(this),n==="replace")t.replaceChildren(...s);else if(n==="append")t.append(...s);else if(n==="prepend")t.prepend(...s);else throw new l("view: undefined append mode ("+n+")");return i.forEach(o=>this.comp.doAct(o)),this.comp.trigger("render",this),this}walk(e,t=[]){return $comp.attrs.walk(this.comp,e,t),this}addRef(e,t){f(e,"name","view");var s=this.$(t);return s.length===0?this.comp.warn("view: no element with specific selector ("+t+")"):this.refs[e]?this.refs[e].push(...s):this.refs[e]=s,this}attr(e,t,s){f(t,"name","view");var i=this.$(e);if(s===void 0)return t in this.attrs?this.attrs[t](i[0]):t in i[0]?i[0][t]:i[0].getAttribute(t);i.forEach(n=>{t in this.attrs?this.attrs[t](n,s):t in n?n[t]=s:n.setAttribute(t,s)})}call(e,t,...s){if(f(t,"name","view"),t in this.funs)return this.funs[t](this.$(e),...s);this.comp.warn("view: undefined function ("+t+")")}appendSub(e,t,s=-1,...i){f(t,"name","view"),J(s,"ind","view",-1);var n=this.subs[t],o,a=[];if(!n)throw new l("view: undefined sub ("+t+")");return this.$(e).forEach(d=>{n.$isSub?{el:o,acts:a}=n.fn(d,this,!0,...i):o=n[0].cloneNode(!0),o.$isSub=!0,s===-1||s===d.children.length?d.append(o):s===0?d.prepend(o):d.children[s].before(o),(!("dowalk"in n)||n.dowalk)&&this.walk(o),a?.forEach?.(h=>this.comp.doAct(h))}),this}setSub(e,t,s="append",...i){f(t,"name","view"),f(s,"appendMode","view");var n=this.subs[t],o,a=[];if(!n)throw new l("view: undefined sub ("+t+")");return this.$(e).forEach(d=>{if(n.$isSub?{el:o,acts:a}=n.fn(d,this,!1,...i):o=n.cloneNode(!0).childNodes,s==="append")d.append(...o);else if(s==="prepend")d.prepend(...o);else if(s==="replace")d.replaceChildren(...o);else throw new l("view: undefined append mode ("+s+")");(!("dowalk"in n)||n.dowalk)&&[...d.children].forEach(h=>this.walk(h)),a?.forEach?.(h=>this.comp.doAct(h))}),this}};p(N,"View"),y(N,"defaults",{tempAppendMode:"append",temp:"<span></span>",lazyTemp:!1,el:"<div></div>",subs:{},refs:{}}),y(N,"attrs",G),y(N,"funs",X);var M=class{constructor(e,t){D(e,"effect"),this.comp=e,this.effects={...t},e.on("model:change",this.patch.bind(this))}patch(e,t,s,i,n,o,a){this.effects[s]&&this.effects[s].forEach(d=>typeof d=="string"?e.call(d,o,n,i,s,a):d(e,o,n,i,s,a))}add(e,t){if(typeof t!="function"&&typeof t!="string"&&w(t,"fn","effect"),Array.isArray(e)){var s=p(i=>{var n=e.map(o=>i.get(o));typeof t=="string"?i.call(t,...n):t(...n)},"nfn");return e.forEach(i=>this.add(i,s)),this}return f(e,"name","effect"),e in this.effects?this.effects[e].push(t):this.effects[e]=[t],this}remove(e,t){return f(e,"name","effect"),t?this.effects[e]?this.effects[e]=this.effects[e].filter(s=>s!==t):this.comp.warn("effect: undefined property ("+e+")"):this.effects[e]?this.effects[e]=void 0:this.comp.warn("effect: undefined property ("+e+")"),this}};p(M,"EffectEmmiter");var O=class{constructor(e,t,s){D(e,"signal"),this.comp=e,this.opts={...this.constructor.defaults,...t},this.channels={},this.add(s),e.on("model:change",this.patch.bind(this))}patch(e,t,s,i,n,o,a){this.channels[s]&&this.channels[s].forEach(d=>d[0].set(d[1],o))}add(e,t){if(Array.isArray(e))e.forEach(s=>this.add(s[0],s[1]));else{e?.isComp||(e=$comp.getById(e));for(let s in t)this.channels[s]?this.channels[s].push([e,t[s]]):this.channels[s]=[[e,t[s]]],this.opts.fireOnAdd&&e.set(t[s],this.comp.get(s))}}remove(e,t){if(e?.isComp)if(t!==void 0)this.channels[t]?this.channels[t]=this.channels[t].filter(s=>s[0]!==e):this.comp.warn("signal: undefined property ("+t+")");else for(let s in this.channels)this.channels[s]&&(this.channels[s]=this.channels[s].filter(i=>i[0]!==e));else this.channels[e]||this.comp.warn("signal: undefined property ("+e+")"),this.channels[e]=void 0}};p(O,"Signal"),y(O,"defaults",{fireOnAdd:!0});var _=p((r,e,t,s,i)=>{var{el:n,mtype:o,stype:a,args:d}=e;if(o==="sub")r.view.appendSub(n,a,s,t,...d);else if(o==="comp"){var h=new($comp.get(a))(void 0,...d.slice(1));s===n.children.length?n.append(h.el):n.children[s].before(h.el),h.set(typeof t=="object"?t:d[0]||"value",t),r.addChild(h)}else if(o==="collection"){var h=new($comp.get(a))(void 0,...d.slice(1));s===n.children.length?n.append(h.el):n.children[s].before(h.el),h.set(typeof t=="object"?t:d[0]||"value",t),r.addChild(h),e.collection.add(h,s)}else throw new l("binder handler (for): undefined main type ("+o+")")},"handleCreate"),Q=p((r,e,t,s)=>{var{mtype:i,el:n}=e;if(i==="sub")n.children[t].remove();else if(i==="comp")n.children[t].$comp.remove();else if(i==="collection")n.children[t].$comp.remove(),e.collection.remove(t);else throw new l("binder handler (for): undefined main type ("+i+")")},"handleDelete"),Y=p((r,e,t,s,i)=>{var{mtype:n}=e;if(n==="sub")e.el.children[s].remove(),r.view.appendSub(e.el,e.stype,s,t,...e.args);else if(n==="comp")e.el.children[s].$comp.set(typeof t=="object"?t:e.args[0]||"value",t);else if(n==="collection")e.collection.setOne(t,s);else throw new l("binder handler (for): undefined main type ("+n+")")},"handleChange");var Z={attr(r,e,t){t.view.attr(r.el,r.attr,$comp.temps.parseAttr.handle(r.temp,t,r.el,void 0))},html(r,e,t){r.el.innerHTML=e},text(r,e,t){r.node.textContent=$comp.temps.parseAttr.handle(r.temp,t,r.el,void 0)},attrBasic(r,e,t){t.view.attr(r.el,r.attr,e)},attrCall(r,e,t){t.view.attr(r.el,r.attr,t.call(r.fun,e,...r.args))},if(r,e,t){t.call(r.fun,r.el,r.condF(t,r.el,...r.prop.map(s=>t.get(s))),...r.args)},ifElse(r,e,t){var s=r.prop.map(i=>t.get(i));r.conds.some(i=>i.condF(t,r.el,...s)&&(t.call(i.fun,r.el,!0,...i.args)||!0))},for(r,e,t,s,i,n,o){var{el:a,collection:d}=r;r.mtype==="collection"&&!r.collection&&(r.collection=new $comp.CompCollection([],r.args[0])),o.arr?o["arr:empty"]?(a.replaceChildren(...r.onemptyEls),r.mtype==="collection"&&d.remove(0,r.collection.comps.length)):o["arr:wasempty"]?(a.replaceChildren(),e.forEach((h,c)=>_(t,r,h,c,i))):(o["arr:patch"].forEach(h=>{if(h.type==="add"&&h.values.forEach((c,g)=>_(t,r,c,h.ind+g,i)),h.type==="delete")for(let c=h.count;c>0;c--)Q(t,r,h.ind+c-1,i);h.type==="change"&&h.values.forEach((c,g)=>Y(t,r,c,h.ind+g,i))}),r.type==="collection"&&d.set(e)):(a.replaceChildren(...r.onemptyEls),i&&(i.meta["arr:old"]=void 0))}};var V=p((r,e,t=3,s=5,i=n=>n)=>{if(!Array.isArray(r))throw new TypeError("dlff: old of type ("+r?.constructor?.type+") expected (Array)");if(!Array.isArray(e))throw new TypeError("dlff: new of type ("+e?.constructor?.type+") expected (Array)");for(var n=[],o=!1,a,d,h=e.length,c=r.length,g=0,b=0,v=0,x=0;g!==h&&b!==c;){if(v=0,o=!1,a=i(r[b]),d=i(e[g]),a===d){b++,g++;continue}for(;v!==t;){if(v++,b+v===c&&g+v===h){n.push({type:"change",ind:b+x,count:v,nind:g}),b=c,g=h,o=!0;break}if(b+v===c||g+v===h)break;if(i(r[b+v])===i(e[g+v])){n.push({type:"change",ind:b+x,count:v,nind:g}),b+=v,g+=v,o=!0;break}}if(!o){for(v=0;v!==s&&(v++,g+v!==h);)if(i(e[g+v])===a){n.push({type:"add",ind:b+x,count:v,nind:g}),g+=v,x+=v,o=!0;break}o||(n.push({type:"delete",ind:b+x,count:1}),x-=1,b++)}}return b!==c&&n.push({type:"delete",ind:b+x,count:c-b}),g!==h&&n.push({type:"add",ind:b+x,count:h-g,nind:g}),n},"simple");var j={Array(r,e,t,s,i){var n,o=e.meta["arr:old"];return i.set?n={...i,"arr:wasempty":!0}:(!o||o.length===0)&&s.length!==0?n={...i,"arr:wasempty":!0}:i["arr:op"]?n={...i,"arr:patch":[{...i,type:i["arr:op"]}]}:s.length===0?n={...i,"arr:empty":!0}:n={...i,"arr:patch":V(o,s).map(a=>({...a,values:s.slice(a.nind,a.nind+a.count)}))},e.meta["arr:old"]=[...s],n.arr=!0,n}};var F=class{constructor(e,t,s={},i={}){D(e,"binder"),this.comp=e,this.opts={...this.constructor.defaults,...t},this.handlers=Z,this.prehandlers=j,this.binds={},this.sets={};for(let n in s)s[n].forEach(o=>this.addB(n,o));for(let n in i)i[n].forEach(o=>this.addS(n,o));e.on("model:change",this.patch.bind(this)),this.opts.setOnInit&&e.on("init",()=>this.fireSet())}patch(e,t,s,i,n,o,a){this.binds[s]&&((a.prehandle===void 0&&this.opts.prehandle||a.prehandle)&&(a=this.prehandle(i,n,o,a)),this.binds[s].forEach(d=>this.handlers[d.type](d,o,this.comp,n,i,s,a)))}prehandle(e,t,s,i){return s?.constructor?.name in this.prehandlers?this.prehandlers[s?.constructor?.name](this.comp,e,t,s,i):i}addB(e,t,s=!0,i=this.opts.prehandle){var n,o,a;if($(t.el,"binder"),!(t?.type in this.handlers))throw new l("binder: undefined bind type ("+t.type+")");return Array.isArray(e)?e.forEach(d=>this.binds[d]?this.binds[d].push(t):this.binds[d]=[t]):this.binds[e]?this.binds[e].push(t):this.binds[e]=[t],Array.isArray(e)||([n,o]=this.comp.model.getLow(e)),s&&this.opts.setOnDefine&&(i&&(a=this.prehandle(e,n,n,{})),this.handlers[t.type](t,n,this.comp,n,o,e,{...a,set:!0})),this}addS(e,t,s=!0,i=this.opts.prehandle){var n,o,a;if($(t.el,"binder"),!(t?.type in this.handlers))throw new l("binder: undefined bind type ("+t.type+")");return Array.isArray(e)?e.forEach(d=>this.sets[d]?this.sets[d].push(t):this.sets[d]=[t]):this.sets[e]?this.sets[e].push(t):this.sets[e]=[t],Array.isArray(e)||([n,o]=this.comp.model.getLow(e)),s&&this.opts.setOnDefine&&(i&&(a=this.prehandle(e,n,n,{})),this.handlers[t.type](t,n,this.comp,n,o,e,{set:!0})),this}remove(e,t){if(e||(this.binds[t]=[],this.sets[t]=[]),$(e,"binder"),t!==void 0)this.binds[t]=this.binds[t].filter(s=>s.el!==e),this.sets[t]=this.sets[t].filter(s=>s.el!==e);else{for(let s in this.binds)this.binds[s]=this.binds[s].filter(i=>i.el!==e);for(let s in this.sets)this.sets[s]=this.sets[s].filter(i=>i.el!==e)}return this}fireSet(e,t={},s=this.opts.prehandle){if(e===void 0){for(let o in this.sets)this.fireSet(o,t,s);return}var[i,n]=this.comp.model.getLow(e);return e in this.sets?(s&&(t=this.prehandle(n,i,i,t)),this.sets[e].forEach(o=>this.handlers[o.type](o,i,this.comp,void 0,n,e,{...t,set:!0,reset:!0}))):this.comp.warn("binder: undefined property ("+e+")"),this}clean(){for(let e in this.binds)this.binds[e]=this.binds[e].filter(t=>document.contains(t.el));for(let e in this.sets)this.sets[e]=this.sets[e].filter(t=>document.contains(t.el));return this}};p(F,"Binder"),y(F,"defaults",{setOnDefine:!0,setOnInit:!0,prehandle:!0});var A=class{class=this.constructor;constructor(e,t,s=[]){t=this.opts={...this.class.defaults,...t},this.id=e?.nodeType===1&&e.hasAttribute("id")?e.getAttribute("id"):typeof t.id=="function"?t.id():t.id,this.parent=null,$comp.addById(this,this.id),this.acts=t.acts,this.funs=this.class.funs,this.events=new this.class.events({},t.addUndefEvent,t.warn),t.eventNames.forEach(i=>this.events.add(i));for(let i in t.events)t.events[i].forEach(n=>this.events.on(i,n));this.onEventsInit(),this.model=new this.class.model(this,t.model,t.data),this.view=new this.class.view(this,t.view,e),this.binder=new this.class.binder(this,t.binder,t.binds,t.sets),this.effects=new this.class.effects(this,t.effect),this.signal=new this.class.signal(this,t.signal,t.sChannels),this.children=[],C(s,"children"),s.forEach(i=>this.addChild(i)),this.on("appended-to-parent",(i,n)=>this.parent=n&&n.trigger("init:child",this)),this.on("deleted-child",(i,n)=>this.children=this.children.filter(o=>o!==n)),this.waitingNb||this.init()}isComp=!0;isDataProvider=!0;isInited=!1;internal_waitingNb=0;get waitingNb(){return this.internal_waitingNb}set waitingNb(e){this.internal_waitingNb=e,e===0&&this.init()}init(){this.opts.walkChilds&&this.walk(),this.isInited=!0,this.trigger("init"),this.callSafe("init")}addChild(e){var t;return e?.isComp?t=e:e?.isCompClass?t=new e:e?.isopts?t=new($comp.get(e.type))(e.el,e.opts,e.children):E(e,"comp","adding child"),this.children.push(t),this.trigger("appended-child",e),t.trigger("appended-to-parent",this),this}onEventsInit(){}remove(){this.trigger("deleted"),this.parent&&this.parent.trigger("deleted-child",this),$comp.root===this&&$comp.events.trigger("delete-root",this)&&($comp.root=null),this.el.remove(),$comp.idmap[this.id]=void 0}warn(e){this.opts.warn&&console[this.opts.warn](e)}addEvent(e){return this.events.add(e),this}on(e,t){return this.events.on(e,t),this}off(e,t){return this.events.off(e,t),this}once(e,t){return this.events.once(e,t),this}hasEvent(e){return this.events.has(e)}trigger(e,...t){return this.events.trigger(e,this,...t),this}addAct(e){if(!e)throw new l("comp: undefined action");return this.acts.push(e),this}doAct(e){if(!e)throw new l("comp: undefined action");return this.opts.doAct?e.el?$comp.acts.do(this,{...e,el:this.view.$(e.el)}):$comp.acts.do(this,e):this.addAct(e),this}doAllActs(){this.acts.forEach(e=>$comp.doAct(this,e))}call(e,...t){f(e,"name");var s=e.split(":");if(s.length===1){if(!(s[0]in this.funs))throw new l("comp: undefined function ("+s[0]+")");return this.funs[s[0]](this,...t)}return $comp.funNS[s[0]](s[1],this,!1,...t)}callSafe(e,...t){var s=e.split(":");return s.length===1?s[0]in this.funs?this.funs[s[0]](this,...t):void 0:$comp.funNS[s[0]](s[1],this,!0,...t)}addProp(e,t,s=!1){var i=this.model.add(e,t,!0);return s?i:this}set(e,t,s=!1){var i=this.model.set(e,t,!0);return s?i:this}get(e){return this.model.get(e)}deleteProp(e){return this.model.delete(e),this}has(e){return this.model.has(e)}addEffect(e,t){return this.effects.add(e,t),this}addSignal(e,t){return this.signal.add(e,t),this}walk(e,t=[]){return e?this.view.$(e).forEach(s=>this.view.walk(s,t)):[...this.el.children].forEach(s=>this.view.walk(s,t)),this}addRef(e,t){return this.view.addRef(e,t),this}};p(A,"Comp"),y(A,"defaults",{id(){return Math.round(Math.random()*$comp.opts.maxCompRandId)},warn:"warn",addUndefEvent:!0,eventNames:["appended-to-parent","appended-child","init","delete","model:add","model:delete","model:change","init:model","init:view","init:child","render","deleted","deleted-child","collection:added"],events:{},get acts(){return[]},doAct:!0,model:{},data:{},view:{},effects:{},signal:{},binder:{},binds:{},sets:{},sChannels:[],walkChilds:!0}),y(A,"events",P),y(A,"model",S),y(A,"view",N),y(A,"binder",F),y(A,"effects",M),y(A,"signal",O),y(A,"funs",{}),y(A,"isCompClass",!0);var ee={propagAttrs:{"comp:log"(r,e,t){r.doAct({type:"comp:log",el:e,data:t})},"comp:logo"(r,e,t){r.doAct({type:"comp:log",el:e,data:t}),e.removeAttribute("comp:logo")},"comp:ref"(r,e,t){r.doAct({type:"comp:ref",el:e,name:t}),e.removeAttribute("comp:ref")},"comp:call"(r,e,t){JSON.parse(t).forEach(s=>r.doAct({type:"comp:call",el:e,fun:s[0],args:s.slice(1)})),e.removeAttribute("comp:call")}},unpropagAttrs:{"comp:this"(r,e,t){r.doAct({type:"comp:this",el:e,name:t}),e.removeAttribute("comp:this")},"comp:sub"(r,e,t){r.doAct({type:"comp:sub",el:e,data:JSON.parse(t)}),e.removeAttribute("comp:sub")},"comp:temp"(r,e){e.removeAttribute("comp:temp"),r.doAct({type:"comp:temp",el:e})}}};var te={handle(r,e,t){return t.forEach(s=>{if(s.startsWith("bind(")){var i,n=s.indexOf(")"),o=s.slice(s.indexOf("(")+1,n).split(","),a=s.slice(n+2);if(a.includes(":")&&([a,i]=a.split(":")),!this.methods[a])throw new CompError("bind:attrs: undefined method ("+a+")");this.methods[a](r,e,e.getAttribute(s),o,s,i?i.replace(/--./,d=>d[2].toUpperCase()):void 0)}}),!0},methods:{attr(r,e,t,s,i){t.startsWith("[")?JSON.parse(t).forEach(n=>r.doAct({type:"bind:attr",el:e,prop:s,attr:n})):r.doAct({type:"bind:attr",el:e,prop:s,attr:t}),e.removeAttribute(i)},"attr-temp"(r,e,t,s,i,n){r.doAct({type:"bind:attr-temp",attr:n,prop:s,el:e,temp:t}),e.removeAttribute(i)},"attr-call"(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"bind:attr-call",el:e,prop:s,attr:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},text(r,e,t,s,i){r.doAct({type:"bind:text",el:e,prop:s}),e.removeAttribute(i)},html(r,e,t,s,i){r.doAct({type:"bind:html",el:e,prop:s}),e.removeAttribute(i)},if(r,e,t,s,i){var n=JSON.parse(t);r.doAct({type:"bind:if",el:e,prop:s,condF:Function("comp","el",s.map(o=>o.replace(/\..*/,"")),n[0].includes(";")?n[0]:"return "+n[0]),fun:n[1],args:n.slice(2)}),e.removeAttribute(i)},"if-else"(r,e,t,s,i){var n=JSON.parse(t),o=s.map(a=>a.replace(/\..*/,""));r.doAct({type:"bind:if-else",el:e,prop:s,conds:n.map(a=>({condF:Function("comp","el",...o,a[0].includes(";")?a[0]:"return "+a[0]),fun:a[1],args:a.slice(2)}))}),e.removeAttribute(i)},for(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"bind:for",el:e,prop:s,mtype:n,stype:o[0],args:o.slice(1),onemptyEls:[...e.childNodes]}),e.removeAttribute(i)}}};var re={handle(r,e,t){return t.forEach(s=>{if(s.startsWith("set(")){var i,n=s.indexOf(")"),o=s.slice(s.indexOf("(")+1,n).split(","),a=s.slice(n+2);if(a.includes(":")&&([a,i]=a.split(":")),!this.methods[a])throw new CompError("set:attrs: undefined method ("+a+")");this.methods[a](r,e,e.getAttribute(s),o,s,i?i.replace(/--./,d=>d[2].toUpperCase()):void 0)}}),!0},methods:{attr(r,e,t,s,i){JSON.parse(t).forEach(n=>r.doAct({type:"set:attr",el:e,prop:s,attr:n})),e.removeAttribute(i)},"attr-temp"(r,e,t,s,i,n){r.doAct({type:"set:attr-temp",attr:n,prop:s,el:e,temp:t}),e.removeAttribute(i)},"attr-call"(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"set:attr-call",el:e,prop:s,attr:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},text(r,e,t,s,i){r.doAct({type:"set:text",el:e,prop:s}),e.removeAttribute(i)},html(r,e,t,s,i){r.doAct({type:"set:html",el:e,prop:s}),e.removeAttribute(i)},if(r,e,t,s,i){var n=JSON.parse(t);r.doAct({type:"set:if",el:e,prop:s,condF:Function("comp","el",s.map(o=>o.replace(/\..*/,"")),n[0].includes(";")?n[0]:"return "+n[0]),fun:n[1],args:n.slice(2)}),e.removeAttribute(i)},"if-else"(r,e,t,s,i){var n=JSON.parse(t),o=s.map(a=>a.replace(/\..*/,""));r.doAct({type:"set:if-else",el:e,prop:s,conds:n.map(a=>({condF:Function("comp","el",...o,a[0].includes(";")?a[0]:"return "+a[0]),fun:a[1],args:a.slice(2)}))}),e.removeAttribute(i)},for(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"set:for",el:e,prop:s,mtype:n,stype:o[0],args:o.slice(1),onemptyEls:[...e.childNodes]}),e.removeAttribute(i)}}};var se={handle(r,e,t){return t.forEach(s=>{if(s.startsWith("on(")){var i,n=s.indexOf(")"),o=s.indexOf(":"),a=s.slice(s.indexOf("(")+1,n).split(","),d=s.slice(n+1,o).split("."),h=s.slice(o+1);if(h.includes(":")&&([h,i]=h.split(":")),!this.methods[h])throw new CompError("on:attrs: undefined method ("+h+")");this.methods[h](r,e,e.getAttribute(s),a,s,d,i?i.replace(/--./,c=>c[2].toUpperCase()):void 0)}}),!0},methods:{call(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"on:call",el:e,events:s,modifs:n,fun:o[0],args:o.slice(1)}),e.removeAttribute(i)},set(r,e,t,s,i,n){var o=JSON.parse(t);r.doAct({type:"on:set",el:e,events:s,modifs:n,prop:o[0],value:o[1]}),e.removeAttribute(i)},"set-fun"(r,e,t,s,i,n,o){var a=JSON.parse(t);r.doAct({type:"on:set-fun",el:e,events:s,modifs:n,prop:a[0],fun:o,args:a.slice(1)}),e.removeAttribute(i)},"set-attr"(r,e,t,s,i,n,o){r.doAct({type:"on:set-attr",el:e,events:s,modifs:n,prop:t,attr:o}),e.removeAttribute(i)},"set-attr-fun"(r,e,t,s,i,n,o){var a=JSON.parse(t);r.doAct({type:"on:set-attr-fun",el:e,events:s,modifs:n,prop:a[0],attr:a[1],fun:o,args:a.slice(2)}),e.removeAttribute(i)}}};var ie={handlers:{"use:comp":ee,"use:bind":te,"use:set":re,"use:on":se},curEl:null,curAttr:null,add(r,e){f(r,"name","attrs"),this.handlers[r]=e},walk(r,e,t=[]){if(E(r,"attrs"),$(e,"attrs"),C(t,"forceNS","attrs"),!e.hasAttribute("is:static")){this.curEl=e;var s=e.getAttributeNames(),i=!0;t.concat(s.filter(n=>n.startsWith("use")&&!t.includes(n))).forEach(n=>{let o=this.handlers[n];if(o.handle)return i=o.handle(r,e,s)||i;s.forEach(a=>{this.curAttr=a,a in o.propagAttrs&&o.propagAttrs[a](r,e,e.getAttribute(a)),a in o.unpropagAttrs&&(o.unpropagAttrs[a](r,e,e.getAttribute(a)),i=!1)})}),i&&[...e.children].forEach(n=>n.$comp?n.$comp.walk():this.walk(r,n))}},clean(r){$(r,"attrs"),r.getAttributeNames().forEach(e=>{e.startsWith("use")&&r.removeAttribute(e)}),[...r.children].forEach(e=>this.clean(e))}};var ne={"comp:this"(r,e){var{el:t,name:s}=e;t.forEach(i=>{let n=new($comp.get(s))(i);r.addChild(n)})},"comp:log"(r,e){console.log([e.data||"hallo",e?.el?.[0],r])},"comp:sub"(r,e){r.view.setSub(e.el,...e.data)},"comp:ref"(r,e){r.view.addRef(e.name,e.el)},"comp:call"(r,e){r.call(e.fun,e.el[0],...e.args)},"comp:temp"(r,e){[...e.el[0].children].forEach(t=>r.walk(t,["use:bind","use:set","use:on"]))}};var oe={"bind:attr"(r,e){r.binder.addB(e.prop,{type:"attrBasic",el:e.el[0],attr:e.attr})},"bind:attr-temp"(r,e){r.binder.addB(e.prop,{type:"attr",el:e.el[0],attr:e.attr,temp:$comp.temps.parseAttr(e.temp,r,e.el[0])})},"bind:attr-call"(r,e){r.binder.addB(e.prop,{type:"attrCall",el:e.el[0],attr:e.attr,fun:e.fun,args:e.args})},"bind:text"(r,e){var t=e.el[0];t.childNodes.forEach(s=>{if(s.nodeType===s.TEXT_NODE){var i=$comp.temps.parseAttr(s.textContent,r,t);r.binder.addB(e.prop,{type:"text",el:t,node:s,temp:i})}})},"bind:html"(r,e){r.binder.addB(e.prop,{type:"html",el:e.el[0]})},"bind:if"(r,e){r.binder.addB(e.prop,{type:"if",el:e.el[0],prop:e.prop,condF:e.condF,fun:e.fun,args:e.args})},"bind:if-else"(r,e){r.binder.addB(e.prop,{type:"ifElse",el:e.el[0],prop:e.prop,conds:e.conds})},"bind:for"(r,e){r.binder.addB(e.prop,{type:"for",el:e.el[0],mtype:e.mtype,stype:e.stype,args:e.args,onemptyEls:e.onemptyEls})}};var ae={"set:attr"(r,e){r.binder.addS(e.prop,{type:"attrBasic",el:e.el[0],attr:e.attr})},"set:attr-temp"(r,e){r.binder.addS(e.prop,{type:"attr",el:e.el[0],attr:e.attr,temp:$comp.temps.parseAttr(e.temp,r,e.el[0])})},"set:attr-call"(r,e){r.binder.addS(e.prop,{type:"attrCall",el:e.el[0],attr:e.attr,fun:e.fun,args:e.args})},"set:text"(r,e){var t=e.el[0];t.childNodes.forEach(s=>{if(s.nodeType===s.TEXT_NODE){var i=$comp.temps.parseAttr(s.textContent,r,t);r.binder.addS(e.prop,{type:"text",el:t,node:s,temp:i})}})},"set:html"(r,e){r.binder.addS(e.prop,{type:"html",el:e.el[0]})},"set:if"(r,e){r.binder.addS(e.prop,{type:"if",el:e.el[0],prop:e.prop,condF:e.condF,fun:e.fun,args:e.args})},"set:if-else"(r,e){r.binder.addS(e.prop,{type:"ifElse",el:e.el[0],prop:e.prop,conds:e.conds})},"set:for"(r,e){r.binder.addS(e.prop,{type:"for",el:e.el[0],mtype:e.mtype,stype:e.stype,args:e.args,onemptyEls:e.onemptyEls})}};var I=p((r,e,t,s=[],i=[],...n)=>{E(r,"listen"),$(e,"listen"),w(t,"fn","listen"),C(s,"events","listen"),s.length===0&&r.warn("listen: no specified events"),C(i,"modifiers","listen");var o=i.includes("preventdefaults"),a=i.includes("once"),d=i.includes("capture"),h=i.includes("passive"),c=i.includes("stoppropagation"),g=i.includes("self"),b=i.includes("trusted"),v=p(x=>{b&&!x.isTrusted||g&&x.target!==e||(o&&x.preventDefault(),c&&x.stopPropagation(),t(r,e,x,...n))},"fn");return s.forEach(x=>e.addEventListener(x,v,{once:a,capture:d,passive:h})),v},"handleListen");var de={"on:call"(r,e){var{el:t,fun:s,args:i}=e;t=t[0],I(r,t,n=>r.call(s,t,...i),e.events,e.modifs)},"on:set"(r,e){var{prop:t,value:s}=e;I(r,e.el[0],i=>r.set(t,s),e.events,e.modifs)},"on:set-fun"(r,e){var{prop:t,fun:s,value:i,args:n}=e;I(r,e.el[0],o=>r.model.setFn(t,s,!0,...n),e.events,e.modifs)},"on:set-attr"(r,e){var{prop:t,attr:s,el:i}=e;i=i[0],I(r,i,n=>r.set(t,r.view.attr(i,s)),e.events,e.modifs)},"on:set-attr-fun"(r,e){var{prop:t,attr:s,el:i,fun:n,args:o}=e;i=i[0],I(r,i,a=>r.model.setFn(t,n,!1,r.view.attr(i,s),...o),e.events,e.modifs)}};var he={actions:{...ne,...oe,...ae,...de},add(r,e){f(r,"type","action"),w(e,"action","action"),this.actions[r]=e},do(r,e){if(E(r),!e?.type||!(e.type in this.actions))throw new l("action: undefined action type ("+e?.type+")");this.actions[e.type](r,e)}};var pe={mg(r,e,t,s,...i){if(!(t&&r in e.model.funs))return e.model.getFn(s,r,...i)},m(r,e,t,...s){var i=e.model.funs[r];if(i)return i(e.model,...s);if(t)return;throw new l("model: undefined function ("+r+")")},v(r,e,t,s,...i){if(!(t&&r in e.view.funs))return e.view.call(s,r,...i)}};var k=p((r,e,t,s)=>{f(r,"str","parse attr");var i=r.split(k.regex),n=[];return i.forEach(o=>{if(o!=="")if(o.startsWith("{")){if(o.startsWith("{{#"))return n.push({type:"val",value:Function("comp","model","el","value",o.includes(";")?o.slice(3,-2):"return "+o.slice(3,-2))(e,e.model,t,s)});if(o.startsWith("{{"))return n.push({type:"exp",fun:Function("comp","model","el","value",o.includes(";")?o.slice(2,-2):"return "+o.slice(2,-2))});if(o.startsWith("{$"))return n.push(ve(o.slice(2,-1)));if(o.startsWith("{@"))return n.push({type:"vNS",value:o.slice(2,-1).split(":")});n.push({type:"prop",name:o.slice(1,-1)})}else n.push({type:"val",value:o})}),n},"parse");k.regex=/({{[\s\S]+?}}|{[^{]+})/;k.parseArg=r=>{if(r[0]==="@")return r.slice(1).split(":");if(r==="true")return!0;if(r==="false")return!1;if(r==="null")return null;if(r!=="undefined"){var e=Number(r);return isNaN(e)?r:e}};var ge=p(r=>r.split(",").map(e=>e.trim()).map(k.parseArg),"parseArgs"),ve=p(r=>{var e=r.trim().split("(");return{type:"call",fun:e[0].trim(),args:ge(e[1].trimEnd().slice(0,-1))}},"parseFun");k.valueNS={attr(r,e,t,s){return r.view.attr(e,s[1])},prop(r,e,t,s){return r.get(s[1])}};k.handle=(r,e,t,s)=>{if(E(e,"parse attr"),$(t,"parse attr"),typeof r=="string")var i=k(r,e,t,s);else if(Array.isArray(r))var i=r;else throw new l("parse attr: str of type ("+r?.constructor?.name+"), expected (String) or (Array)");return i.map(n=>{if(n.type==="val")return n.value;if(n.type==="prop")return e.get(n.name);if(n.type==="exp")return n.fun(e,e.model,t,s);if(n.type==="call")return e.call(obj.fun,...obj.args.map(o=>Array.isArray(o)?k.valueNS[o[0]](e,t,s,o):o));if(n.type==="vNS")return k.valueNS[n.value[0]](e,t,s,n.value);throw new l("parse attr: undefined attribute expression type ("+n.type+")")}).join("")};var le={temps:{},subs:{},add(r,e){f(r,"name","temps"),r in this.temps&&$comp.warn("comp: adding defined template ("+r+")");var t;typeof e=="string"?(t=W(e),this.temps[r]=()=>({els:t.map(s=>s.cloneNode(!0)),acts:[]})):e?.nodeType===1?this.temps[r]=()=>({els:[...e.cloneNode(!0).childNodes],acts:[]}):(w(e,"temp","temps"),this.temps[r]=e),$comp.events.trigger("temp-added",r,this.temps[r])},has(r){return f(r,"name","temps"),r in this.temps},get(r){if(f(r,"name","temps"),!(r in this.temps))throw new l("comp: undefined template ("+r+")");return this.temps[r]},getLazy(r,e){f(e,"name","temps");var t=p(s=>{s===e&&($comp.events.off("temp-added",t),r.render(),r.comp.waitingNb-=1)},"fn");this.temps[e]?t(e):$comp.events.on("temp-added",t)},addSub(r,e){f(r,"name","temps"),r in this.subs&&$comp.warn("comp: adding defined sub ("+r+")");var t;typeof e=="string"?(t=W(e),this.subs[r]={$isSub:!0,fn(){return{el:t.map(s=>s.cloneNode(!0)),acts:[]}}}):e?.nodeType===1?this.subs[r]={$isSub:!0,fn(){return{el:[...e.cloneNode(!0).childNodes],acts:[]}}}:(w(e?.fn,"fn","temps"),this.subs[r]=e)},hasSub(r){return f(r,"name","temps"),r in this.subs},getSub(r){if(f(r,"name","temps"),!(r in this.subs))throw new l("comp: undefined sub ("+r+")");return this.subs[r]},parseAttr:k,listen:I};var fe=p((r,e)=>{throw new l("collection: index ("+r+") greater than length ("+e+")")},"throwIndGT"),R=class{constructor(e=[],t="value"){C(e,"comps"),this.comps=e,this.propName=t,e.forEach(s=>s.trigger("collection:added",this))}add(e,t){return J(t,"index","collection"),t>this.comps.length&&fe(t,this.comps.length),this.comps.splice(t,0,e),e.trigger("collection:added",this),this}get(e){return this.comps[e]}get length(){return this.comps.length}set(e){return Array.isArray(e)?(e.length!==this.comps.length&&$comp.warn("collection: values length ("+e.length+") is not equal to length ("+this.comps.length+")"),e.forEach((t,s)=>this.comps[s]&&this.comps[s].set(typeof t=="object"?t:this.propName,t))):$comp.warn("collection: values of type ("+e?.constructor?.name+"), expected (Array)"),this}setOne(e,t){return J(t,"index","collection"),this.comps.length<=t?$comp.warn("collection: index ("+t+") greater than length ("+this.comps.length+")"):this.comps[t].set(typeof e=="object"?e:this.propName,e),this}remove(e,t=1){J(e,"index","collection"),e>=this.comps.length&&fe(e,this.comps.length),this.comps.splice(e,t)}};p(R,"CompCollection");var m={currentComp:null,compStack:[],push(r){E(r,"functional"),this.compStack.push(r),this.currentComp=r},pop(){this.compStack.pop(),this.currentComp=this.compStack.length===0?null:this.compStack[this.compStack.length-1]},getCur(r=!0){if(this.currentComp)return this.currentComp;if(r)throw new l("functional: component stack length is 0")},enableFor(r){return w(r,"fn","functional"),(e,...t)=>{this.push(e),r(...t),this.pop()}},currentClass:null,createComp(r,e,t=Comp){w(r,"createFn","functional"),w(e,"initFn","functional"),z(t,"superClass","functional");var s=p(class extends t{init(){m.push(this);var o=e();o&&this.set(o),m.pop(),super.init()}static funs={...t.funs};static defaults={...t.defaults}},"FComp");this.currentClass=s;var i=r();return s.defaults.view.temp=i,this.currentClass=null,s},useClass(){if(!this.currentClass)throw new l("functional: currentClass is not defined");return this.currentClass},useDefaults(){return this.useClass().defaults},setFun(r,e){this.useClass().funs[r]=this.enableFor(e)},useComp(){return this.getCur()},useStore(){return this.getCur().model.toProxy()},useState(r,e){var t=this.getCur(),s=!1;e!==void 0&&!t.has(r)&&(t.set(r,e),s=!0);var[i,n]=t.model.getLow(r);return[i,o=>t.set(r,o),()=>t.get(r),n]},useEffect(r,e){this.getCur().addEffect(r,typeof e=="string"?e:this.enableFor(e))},useSignal(r,e){this.getCur().addSignal(r,e)},useEvent(r,e){this.getCur().on(r,this.enableFor(e))},useTrigger(r,...e){this.getCur().trigger(r,...e)},useCall(r,...e){return this.getCur().call(r,...e)},useCallSafe(r,...e){return this.getCur().callSafe(r,...e)},useRef(r){return this.getCur().refs[r]},use$(...r){return this.getCur().view.$(...r)},useEl(){return this.getCur().el},useAttr(r,e,t){return this.getCur().view.attr(r,e,t)}};for(let r in m)typeof m[r]=="function"&&(m[r]=m[r].bind(m));var T=class{isComp=!0;constructor(e,...t){this.name=e,this.args=t,this.fn=this.handle.bind(this),$comp.events.on("comp-added",this.fn)}trigger(e,...t){if(e==="appended-to-parent")this.parent=t[0];else if(e==="deleted-child")$comp.events.off("comp-added",this.fn);else throw new CompError("lazy comp: undefined event ("+e+")")}handle(e,t){if(e===this.name){if($comp.events.off("comp-added",this.fn),!this.parent)throw new CompError("lazy comp: undefined parent");var s=new t(...this.args);this.parent.children[this.parent.children.indexOf(this)]=s,s.trigger("appended-to-parent",this.parent)}}};p(T,"LazyComp"),y(T,"isCompClass",!0);var ue={add(){throw new CompError("lazy comp manager: unsupported method (add)")},has(){throw new CompError("lazy comp manager: unsupported method (has)")},get(r){return $comp.has(r)?$comp.get(r):ye(r)}},ye=p(r=>new Proxy(T,{get(e,t){return e[t]},construct(e,t){return new e(r,...t)}}),"createProxy");var u={isDataProvider:!0,opts:{warn:"warn",maxCompRandId:2**30},warn(r){this.opts.warn&&console[this.opts.warn](r)},comps:{basic:A},compMans:{lazy:ue},add(r,e){z(e,"adding class"),f(r,"name");var t=r.split(":");if(t.length!==1){if(!this.compMans[t[0]])throw new l("comp: undefined component manager ("+t[0]+")");return this.compMans[t[0]].add(t[1])}r in this.comps&&this.warn("comp: adding defined component ("+r+")"),this.comps[r]=e,this.events.trigger("comp-added",r,e)},get(r){if(r?.isCompClass)return r;if(r?.isComp)return r.class;f(r,"name");var e=r.split(":");if(e.length!==1){if(!this.compMans[e[0]])throw new l("comp: undefined component manager ("+e[0]+")");return this.compMans[e[0]].get(e[1])}var t=this.comps[r];if(t)return t;throw new l("comp: undefined comp ("+r+")")},has(r){f(r,"name");var e=r.split(":");return e.length===1?r in this.comps:this.compMans[e[0]].has(e[1])},root:null,setRoot(r,e="basic",...t){return $(r),this.root=e.isComp?e:new(this.get(e))(r,...t),this.events.trigger("set-root",this.root),this.root},idmap:{},addById(r,e){return E(r),this.idmap[e]?this.warn("comp: defined id ("+e+")"):(this.idmap[e]=r,this.events.trigger("id-added")),this},getById(r,e=!0){var t=this.idmap[r];if(!t&&e)throw new l("comp: undefined component of id ("+r+")");return t},events:new P,on(r,e){return this.events.on(r,e),this},off(r,e){return this.events.off(r,e),this},trigger(r,...e){return this.events.trigger(r,this,...e),this},acts:he,doAct(r,e){this.acts.do(r,e)},attrs:ie,walk(r,e){this.attrs.walk(r,e)},funNS:pe,func:m,temps:le,addProp(r,e,t){var s=this.model.add(r,e,!0);return t?s:this},setProp(r,e,t=!1){var s=this.model.set(r,e,!0);return t?s:this},getProp(r,e=!1){return this.model.get(r,e)},deleteProp(r){return this.model.delete(r),this},hasProp(r){return this.model.has(r)},addEffect(r,e){return this.effect.add(r,e),this},addSignal(r,e){return this.signal.add(r,e),this},classes:{comp:A,event:P,error:l,model:S,view:N,binder:F,effect:M,signal:O,collection:R,lazyComp:T},Comp:A,EventEmmiter:P,CompError:l,Model:S,View:N,CompCollection:R,Binder:F,EffectEmmiter:M,Signal:O,LazyComp:T};for(let r in u)u[r]?.bind&&!u[r].prototype&&(u[r]=u[r].bind(u));globalThis.$comp=u;globalThis.CompError=l;globalThis.Comp=A;["comp-added","set-root","delete-root","id-added","temp-added","model:add","model:delete","model:change","init:model"].forEach(r=>u.events.add(r));Object.assign(u,{model:new S(u,{},{}),signal:new O(u,{},[]),effect:new M(u,{})});A.defaults.warn=u.opts.warn;var Nr=u,kr=u.get,Or=u.add,Pr=u.has,Mr=u.setRoot,Fr=u.getById,Tr=u.addById,Dr=u.on,Br=u.off,Ir=u.once,Lr=u.trigger,Jr=u.doAct,Rr=u.walk,Wr=u.addProp,zr=u.setProp,Hr=u.getProp,_r=u.hasProp,Ur=u.deleteProp,qr=u.addEffect,Kr=u.addSignal,Gr=m.createComp,Xr=m.enableFor,Qr=m.useClass,Yr=m.useDefaults,Zr=m.setFun,Vr=m.useComp,jr=m.useStore,es=m.useState,ts=m.useEffect,rs=m.useEvent,ss=m.useTrigger,is=m.useSignal,ns=m.useCall,os=m.useCallSafe,as=m.useRef,ds=m.use$,hs=m.useEl,ps=m.useAttr;export{u as $comp,A as Comp,l as CompError,M as EffectEmmiter,P as EventEmmiter,S as Model,O as Signal,N as View,Or as add,Tr as addById,qr as addEffect,Wr as addProp,Kr as addSignal,Gr as createComp,Nr as default,Ur as deleteProp,Jr as doAct,Xr as enableFor,kr as get,Fr as getById,Hr as getProp,Pr as has,_r as hasProp,Br as off,Dr as on,Ir as once,Zr as setFun,zr as setProp,Mr as setRoot,Lr as trigger,ds as use$,ps as useAttr,ns as useCall,os as useCallSafe,Qr as useClass,Vr as useComp,Yr as useDefaults,ts as useEffect,hs as useEl,rs as useEvent,as as useRef,is as useSignal,es as useState,jr as useStore,ss as useTrigger,Rr as walk};
